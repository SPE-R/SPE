<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Poisson regression &amp; analysis of curved effects | Statistical Practice in Epidemiology with R</title>
  <meta name="description" content="This is the SPE-R 2024 exercises book" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Poisson regression &amp; analysis of curved effects | Statistical Practice in Epidemiology with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the SPE-R 2024 exercises book" />
  <meta name="github-repo" content="spe-r/spe" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Poisson regression &amp; analysis of curved effects | Statistical Practice in Epidemiology with R" />
  
  <meta name="twitter:description" content="This is the SPE-R 2024 exercises book" />
  

<meta name="author" content="Krista Fischer" />
<meta name="author" content="Martyn Plummer" />
<meta name="author" content="Janne Pitkäniemi" />
<meta name="author" content="Bendix Carstensen" />
<meta name="author" content="Damien Georges" />
<meta name="author" content="Esa Läärä" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estimation-of-effects-simple-and-more-complex.html"/>
<link rel="next" href="causal-inference.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SPE-R practicals</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html"><i class="fa fa-check"></i><b>1</b> Practice with basic R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#the-working-directory"><i class="fa fa-check"></i><b>1.1</b> The working directory</a></li>
<li class="chapter" data-level="1.2" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#the-workspace"><i class="fa fa-check"></i><b>1.2</b> The workspace</a></li>
<li class="chapter" data-level="1.3" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#using-r-as-a-calculator"><i class="fa fa-check"></i><b>1.3</b> Using R as a calculator</a></li>
<li class="chapter" data-level="1.4" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#vectors"><i class="fa fa-check"></i><b>1.4</b> Vectors</a></li>
<li class="chapter" data-level="1.5" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#sequences"><i class="fa fa-check"></i><b>1.5</b> Sequences</a></li>
<li class="chapter" data-level="1.6" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#displaying-and-changing-parts-of-a-vector-indexing"><i class="fa fa-check"></i><b>1.6</b> Displaying and changing parts of a vector (indexing)</a></li>
<li class="chapter" data-level="1.7" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#lists"><i class="fa fa-check"></i><b>1.7</b> Lists</a></li>
<li class="chapter" data-level="1.8" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#data-frames"><i class="fa fa-check"></i><b>1.8</b> Data frames</a></li>
<li class="chapter" data-level="1.9" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#working-with-built-in-data-frames"><i class="fa fa-check"></i><b>1.9</b> Working with built-in data frames</a></li>
<li class="chapter" data-level="1.10" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#referencing-parts-of-the-data-frame-indexing"><i class="fa fa-check"></i><b>1.10</b> Referencing parts of the data frame (indexing)</a></li>
<li class="chapter" data-level="1.11" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#summaries"><i class="fa fa-check"></i><b>1.11</b> Summaries</a></li>
<li class="chapter" data-level="1.12" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#generating-new-variables"><i class="fa fa-check"></i><b>1.12</b> Generating new variables</a></li>
<li class="chapter" data-level="1.13" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#turning-a-variable-into-a-factor"><i class="fa fa-check"></i><b>1.13</b> Turning a variable into a factor</a></li>
<li class="chapter" data-level="1.14" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#frequency-tables"><i class="fa fa-check"></i><b>1.14</b> Frequency tables</a></li>
<li class="chapter" data-level="1.15" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#grouping-the-values-of-a-numeric-variable"><i class="fa fa-check"></i><b>1.15</b> Grouping the values of a numeric variable</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html"><i class="fa fa-check"></i><b>2</b> Reading data into <code>R</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#data-sources"><i class="fa fa-check"></i><b>2.2</b> Data sources</a></li>
<li class="chapter" data-level="2.3" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#data-in-text-files"><i class="fa fa-check"></i><b>2.3</b> Data in text files</a></li>
<li class="chapter" data-level="2.4" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#things-that-can-go-wrong"><i class="fa fa-check"></i><b>2.4</b> Things that can go wrong</a></li>
<li class="chapter" data-level="2.5" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#forgetting-the-headers"><i class="fa fa-check"></i><b>2.5</b> Forgetting the headers</a></li>
<li class="chapter" data-level="2.6" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#using-the-wrong-separator"><i class="fa fa-check"></i><b>2.6</b> Using the wrong separator</a></li>
<li class="chapter" data-level="2.7" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#mis-specifying-the-representation-of-missing-values"><i class="fa fa-check"></i><b>2.7</b> Mis-specifying the representation of missing values</a></li>
<li class="chapter" data-level="2.8" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#spreadsheet-data"><i class="fa fa-check"></i><b>2.8</b> Spreadsheet data</a></li>
<li class="chapter" data-level="2.9" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#reading-data-from-the-internet"><i class="fa fa-check"></i><b>2.9</b> Reading data from the Internet</a></li>
<li class="chapter" data-level="2.10" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#reading-from-the-clipboard"><i class="fa fa-check"></i><b>2.10</b> Reading from the clipboard</a></li>
<li class="chapter" data-level="2.11" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#binary-data"><i class="fa fa-check"></i><b>2.11</b> Binary data</a></li>
<li class="chapter" data-level="2.12" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#summary"><i class="fa fa-check"></i><b>2.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with <code>tidyverse</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#the-births-data"><i class="fa fa-check"></i><b>3.2</b> The <code>births</code> data</a></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#tibble-vs-data.frame"><i class="fa fa-check"></i><b>3.3</b> <code>tibble</code> vs <code>data.frame</code></a></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#piping-functions"><i class="fa fa-check"></i><b>3.4</b> Piping functions</a></li>
<li class="chapter" data-level="3.5" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#mutate-columns"><i class="fa fa-check"></i><b>3.5</b> <code>mutate</code> columns</a></li>
<li class="chapter" data-level="3.6" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#select-columns-filter-and-arrange-rows"><i class="fa fa-check"></i><b>3.6</b> <code>select</code> columns, <code>filter</code> and <code>arrange</code> rows</a></li>
<li class="chapter" data-level="3.7" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#group_by-and-summarise-data"><i class="fa fa-check"></i><b>3.7</b> <code>group_by</code> and <code>summarise</code> data</a></li>
<li class="chapter" data-level="3.8" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#multiple-grouping"><i class="fa fa-check"></i><b>3.8</b> Multiple grouping</a></li>
<li class="chapter" data-level="3.9" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#bind-and-join-tables"><i class="fa fa-check"></i><b>3.9</b> Bind and join tables</a></li>
<li class="chapter" data-level="3.10" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#data-visualization-with-ggplot2"><i class="fa fa-check"></i><b>3.10</b> Data Visualization with ggplot2</a></li>
<li class="chapter" data-level="3.11" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#pivoting-data-with-tidyr"><i class="fa fa-check"></i><b>3.11</b> pivoting data with tidyr</a></li>
<li class="chapter" data-level="3.12" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#reading-files-with-readr"><i class="fa fa-check"></i><b>3.12</b> reading files with readr</a></li>
<li class="chapter" data-level="3.13" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#string-manipulation-with-stringr"><i class="fa fa-check"></i><b>3.13</b> String manipulation with stringr</a></li>
<li class="chapter" data-level="3.14" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#purrr-package-to-apply-functions-to-list"><i class="fa fa-check"></i><b>3.14</b> purrr package to apply functions to list</a></li>
<li class="chapter" data-level="3.15" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#bonus-rendering-tables"><i class="fa fa-check"></i><b>3.15</b> Bonus: Rendering tables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tabulation.html"><a href="tabulation.html"><i class="fa fa-check"></i><b>4</b> Tabulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tabulation.html"><a href="tabulation.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="tabulation.html"><a href="tabulation.html#the-births-data-1"><i class="fa fa-check"></i><b>4.2</b> The births data</a></li>
<li class="chapter" data-level="4.3" data-path="tabulation.html"><a href="tabulation.html#one-way-tables"><i class="fa fa-check"></i><b>4.3</b> One-way tables</a></li>
<li class="chapter" data-level="4.4" data-path="tabulation.html"><a href="tabulation.html#improving-the-presentation-of-tables"><i class="fa fa-check"></i><b>4.4</b> Improving the Presentation of Tables</a></li>
<li class="chapter" data-level="4.5" data-path="tabulation.html"><a href="tabulation.html#two-way-tables"><i class="fa fa-check"></i><b>4.5</b> Two-way Tables</a></li>
<li class="chapter" data-level="4.6" data-path="tabulation.html"><a href="tabulation.html#printing"><i class="fa fa-check"></i><b>4.6</b> Printing</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics-in-r.html"><a href="graphics-in-r.html"><i class="fa fa-check"></i><b>5</b> Graphics in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#simple-plot-on-the-screen"><i class="fa fa-check"></i><b>5.1</b> Simple plot on the screen</a></li>
<li class="chapter" data-level="5.2" data-path="graphics-in-r.html"><a href="graphics-in-r.html#colours"><i class="fa fa-check"></i><b>5.2</b> Colours</a></li>
<li class="chapter" data-level="5.3" data-path="graphics-in-r.html"><a href="graphics-in-r.html#adding-to-a-plot"><i class="fa fa-check"></i><b>5.3</b> Adding to a plot</a></li>
<li class="chapter" data-level="5.4" data-path="graphics-in-r.html"><a href="graphics-in-r.html#using-indexing-for-plot-elements"><i class="fa fa-check"></i><b>5.4</b> Using indexing for plot elements</a></li>
<li class="chapter" data-level="5.5" data-path="graphics-in-r.html"><a href="graphics-in-r.html#generating-colours"><i class="fa fa-check"></i><b>5.5</b> Generating colours</a></li>
<li class="chapter" data-level="5.6" data-path="graphics-in-r.html"><a href="graphics-in-r.html#saving-your-graphs-for-use-in-other-documents"><i class="fa fa-check"></i><b>5.6</b> Saving your graphs for use in other documents</a></li>
<li class="chapter" data-level="5.7" data-path="graphics-in-r.html"><a href="graphics-in-r.html#interacting-with-a-plot"><i class="fa fa-check"></i><b>5.7</b> Interacting with a plot</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><i class="fa fa-check"></i><b>6</b> Analysis of hazard rates, their ratios and differences and binary regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#hand-calculations-for-a-single-rate"><i class="fa fa-check"></i><b>6.1</b> Hand calculations for a single rate</a></li>
<li class="chapter" data-level="6.2" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#poisson-model-for-a-single-rate-with-logarithmic-link"><i class="fa fa-check"></i><b>6.2</b> Poisson model for a single rate with logarithmic link</a></li>
<li class="chapter" data-level="6.3" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#poisson-model-for-a-single-rate-with-identity-link"><i class="fa fa-check"></i><b>6.3</b> Poisson model for a single rate with identity link</a></li>
<li class="chapter" data-level="6.4" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#poisson-model-assuming-the-same-rate-for-several-periods"><i class="fa fa-check"></i><b>6.4</b> Poisson model assuming the same rate for several periods</a></li>
<li class="chapter" data-level="6.5" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#analysis-of-rate-ratio"><i class="fa fa-check"></i><b>6.5</b> Analysis of rate ratio</a></li>
<li class="chapter" data-level="6.6" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#analysis-of-rate-difference"><i class="fa fa-check"></i><b>6.6</b> Analysis of rate difference</a></li>
<li class="chapter" data-level="6.7" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#binary-regression"><i class="fa fa-check"></i><b>6.7</b> Binary regression</a></li>
<li class="chapter" data-level="6.8" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#optionalhomework-hand-calculations-and-calculations-using-matrix-tools"><i class="fa fa-check"></i><b>6.8</b> Optional/Homework: Hand calculations and calculations using matrix tools</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html"><i class="fa fa-check"></i><b>7</b> Estimation of effects: simple and more complex</a>
<ul>
<li class="chapter" data-level="7.1" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#response-and-explanatory-variables"><i class="fa fa-check"></i><b>7.1</b> Response and explanatory variables</a></li>
<li class="chapter" data-level="7.2" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#data-set-births"><i class="fa fa-check"></i><b>7.2</b> Data set <code>births</code></a></li>
<li class="chapter" data-level="7.3" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#simple-estimation-with-lm-and-glm"><i class="fa fa-check"></i><b>7.3</b> Simple estimation with <code>lm()</code> and <code>glm()</code></a></li>
<li class="chapter" data-level="7.4" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#stratified-effects-and-interaction-or-effect-measure-modification"><i class="fa fa-check"></i><b>7.4</b> Stratified effects, and interaction or effect-measure modification</a></li>
<li class="chapter" data-level="7.5" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#controlling-or-adjusting-for-the-effect-of-hyp-for-sex"><i class="fa fa-check"></i><b>7.5</b> Controlling or adjusting for the effect of <code>hyp</code> for <code>sex</code></a></li>
<li class="chapter" data-level="7.6" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#numeric-exposure-simple-linear-regression-and-checking-assumptions"><i class="fa fa-check"></i><b>7.6</b> Numeric exposure, simple linear regression and checking assumptions</a></li>
<li class="chapter" data-level="7.7" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#penalized-spline-model"><i class="fa fa-check"></i><b>7.7</b> Penalized spline model</a></li>
<li class="chapter" data-level="7.8" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#analysis-of-binary-outcomes"><i class="fa fa-check"></i><b>7.8</b> Analysis of binary outcomes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html"><i class="fa fa-check"></i><b>8</b> Poisson regression &amp; analysis of curved effects</a>
<ul>
<li class="chapter" data-level="8.1" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#testis-cancer-data-input-and-housekeeping"><i class="fa fa-check"></i><b>8.1</b> Testis cancer: Data input and housekeeping</a></li>
<li class="chapter" data-level="8.2" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#some-descriptive-analysis"><i class="fa fa-check"></i><b>8.2</b> Some descriptive analysis</a></li>
<li class="chapter" data-level="8.3" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#age-and-period-as-categorical-factors"><i class="fa fa-check"></i><b>8.3</b> Age and period as categorical factors</a></li>
<li class="chapter" data-level="8.4" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#generalized-additive-model-with-penalized-splines"><i class="fa fa-check"></i><b>8.4</b> Generalized additive model with penalized splines</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="causal-inference.html"><a href="causal-inference.html"><i class="fa fa-check"></i><b>9</b> Causal inference</a>
<ul>
<li class="chapter" data-level="9.1" data-path="causal-inference.html"><a href="causal-inference.html#proper-adjustment-for-confounding-in-regression-models"><i class="fa fa-check"></i><b>9.1</b> Proper adjustment for confounding in regression models</a></li>
<li class="chapter" data-level="9.2" data-path="causal-inference.html"><a href="causal-inference.html#dag-tools-in-the-package-dagitty"><i class="fa fa-check"></i><b>9.2</b> DAG tools in the package <code>dagitty</code></a></li>
<li class="chapter" data-level="9.3" data-path="causal-inference.html"><a href="causal-inference.html#instrumental-variables-estimation-mendelian-randomization"><i class="fa fa-check"></i><b>9.3</b> Instrumental variables estimation: Mendelian randomization</a></li>
<li class="chapter" data-level="9.4" data-path="causal-inference.html"><a href="causal-inference.html#why-are-simulation-exercises-useful-for-causal-inference"><i class="fa fa-check"></i><b>9.4</b> Why are simulation exercises useful for causal inference?</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="graphics-meccano.html"><a href="graphics-meccano.html"><i class="fa fa-check"></i><b>10</b> Graphics meccano</a>
<ul>
<li class="chapter" data-level="10.1" data-path="graphics-meccano.html"><a href="graphics-meccano.html#base-graphics"><i class="fa fa-check"></i><b>10.1</b> Base graphics</a></li>
<li class="chapter" data-level="10.2" data-path="graphics-meccano.html"><a href="graphics-meccano.html#using-ggplot2"><i class="fa fa-check"></i><b>10.2</b> Using ggplot2</a></li>
<li class="chapter" data-level="10.3" data-path="graphics-meccano.html"><a href="graphics-meccano.html#grid-graphics"><i class="fa fa-check"></i><b>10.3</b> Grid graphics</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html"><i class="fa fa-check"></i><b>11</b> Survival analysis with competing risks: Oral cancer patients</a>
<ul>
<li class="chapter" data-level="11.1" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#description-of-the-data"><i class="fa fa-check"></i><b>11.1</b> Description of the data</a></li>
<li class="chapter" data-level="11.2" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#loading-the-packages-and-the-data"><i class="fa fa-check"></i><b>11.2</b> Loading the packages and the data</a></li>
<li class="chapter" data-level="11.3" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#total-mortality-kaplanmeier-analyses"><i class="fa fa-check"></i><b>11.3</b> Total mortality: Kaplan–Meier analyses</a></li>
<li class="chapter" data-level="11.4" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#total-mortality-by-stage"><i class="fa fa-check"></i><b>11.4</b> Total mortality by stage</a></li>
<li class="chapter" data-level="11.5" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#event-specific-cumulative-mortality-curves"><i class="fa fa-check"></i><b>11.5</b> Event-specific cumulative mortality curves</a></li>
<li class="chapter" data-level="11.6" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#regression-modelling-of-overall-mortality."><i class="fa fa-check"></i><b>11.6</b> Regression modelling of overall mortality.</a></li>
<li class="chapter" data-level="11.7" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#modelling-event-specific-hazards"><i class="fa fa-check"></i><b>11.7</b> Modelling event-specific hazards</a></li>
<li class="chapter" data-level="11.8" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#lexis-object-with-multi-state-set-up"><i class="fa fa-check"></i><b>11.8</b> Lexis object with multi-state set-up</a></li>
<li class="chapter" data-level="11.9" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#optional-poisson-regression-as-an-alternative-to-cox-model"><i class="fa fa-check"></i><b>11.9</b> Optional: Poisson regression as an alternative to Cox model</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html"><i class="fa fa-check"></i><b>12</b> Time-splitting, time-scales and SMR</a>
<ul>
<li class="chapter" data-level="12.1" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html#age-specific-mortality"><i class="fa fa-check"></i><b>12.1</b> Age-specific mortality</a></li>
<li class="chapter" data-level="12.2" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html#smr"><i class="fa fa-check"></i><b>12.2</b> SMR</a></li>
<li class="chapter" data-level="12.3" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html#smr-modeling"><i class="fa fa-check"></i><b>12.3</b> SMR modeling</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><i class="fa fa-check"></i><b>13</b> Nested case-control study and case-cohort study: Risk factors of coronary heart disease</a>
<ul>
<li class="chapter" data-level="13.1" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#reading-the-cohort-data-illustrating-the-study-base-and-risk-sets"><i class="fa fa-check"></i><b>13.1</b> Reading the cohort data, illustrating the study base and risk sets</a></li>
<li class="chapter" data-level="13.2" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#nested-case-control-study"><i class="fa fa-check"></i><b>13.2</b> Nested case-control study</a></li>
<li class="chapter" data-level="13.3" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#case-cohort-study"><i class="fa fa-check"></i><b>13.3</b> Case-cohort study</a></li>
<li class="chapter" data-level="13.4" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#do-these-estimates-resemble-those-obtained-from-nested-case-control-data"><i class="fa fa-check"></i><b>13.4</b> Do these estimates resemble those obtained from nested case-control data?</a></li>
<li class="chapter" data-level="13.5" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#full-cohort-analysis-and-comparisons"><i class="fa fa-check"></i><b>13.5</b> Full cohort analysis and comparisons</a></li>
<li class="chapter" data-level="13.6" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#further-exercises-and-homework"><i class="fa fa-check"></i><b>13.6</b> Further exercises and homework</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html"><i class="fa fa-check"></i><b>14</b> Causal inference 2: Model-based estimation of causal estimands</a>
<ul>
<li class="chapter" data-level="14.1" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#control-of-confounding"><i class="fa fa-check"></i><b>14.1</b> Control of confounding</a></li>
<li class="chapter" data-level="14.2" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#generation-of-target-population-and-true-models"><i class="fa fa-check"></i><b>14.2</b> Generation of target population and true models</a></li>
<li class="chapter" data-level="14.3" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#factual-and-counterfactual-risks---associational-and-causal-contrasts"><i class="fa fa-check"></i><b>14.3</b> Factual and counterfactual risks - associational and causal contrasts</a></li>
<li class="chapter" data-level="14.4" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#outcome-modelling-and-estimation-of-causal-contrasts-by-g-formula"><i class="fa fa-check"></i><b>14.4</b> Outcome modelling and estimation of causal contrasts by g-formula</a></li>
<li class="chapter" data-level="14.5" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#inverse-probability-weighting-ipw-by"><i class="fa fa-check"></i><b>14.5</b> Inverse probability weighting (IPW) by</a></li>
<li class="chapter" data-level="14.6" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#improving-ipw-estimation-and-using-r-package-psweight"><i class="fa fa-check"></i><b>14.6</b> Improving IPW estimation and using R package <code>PSweight</code></a></li>
<li class="chapter" data-level="14.7" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#targeted-maximum-likelihood-estimation-tmle"><i class="fa fa-check"></i><b>14.7</b> Targeted maximum likelihood estimation (TMLE)</a></li>
<li class="chapter" data-level="14.8" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#tmle-with-superlearner"><i class="fa fa-check"></i><b>14.8</b> TMLE with SuperLearner</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="time-dependent-variables-and-multiple-states.html"><a href="time-dependent-variables-and-multiple-states.html"><i class="fa fa-check"></i><b>15</b> Time-dependent variables and multiple states</a>
<ul>
<li class="chapter" data-level="15.1" data-path="time-dependent-variables-and-multiple-states.html"><a href="time-dependent-variables-and-multiple-states.html#the-renal-failure-dataset"><i class="fa fa-check"></i><b>15.1</b> The renal failure dataset</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/SPE-R/SPE" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Practice in Epidemiology with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="poisson-regression-analysis-of-curved-effects" class="section level1 hasAnchor" number="8">
<h1><span class="header-section-number">Chapter 8</span> Poisson regression &amp; analysis of curved effects<a href="poisson-regression-analysis-of-curved-effects.html#poisson-regression-analysis-of-curved-effects" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This exercise deals with modelling incidence rates
using Poisson regression. Our special interest is in
estimating and reporting curved effects of continuous
explanatory variables on the theoretical rate</p>
<p>We analyse the <code>testisDK</code> data found in the
<code>Epi</code> package.
It contains the numbers of cases of testis cancer and mid-year
populations (person-years) in 1-year age groups in Denmark during
1943-96. In this analysis age and calendar time
are first treated as categorical
but finally, a penalized spline model is fitted.</p>
<div id="testis-cancer-data-input-and-housekeeping" class="section level2 hasAnchor" number="8.1">
<h2><span class="header-section-number">8.1</span> Testis cancer: Data input and housekeeping<a href="poisson-regression-analysis-of-curved-effects.html#testis-cancer-data-input-and-housekeeping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Load the packages and the data set, and inspect its structure:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb436-1" tabindex="-1"></a><span class="fu">library</span>(Epi)</span>
<span id="cb436-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb436-2" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code></pre></div>
<pre><code>## Loading required package: nlme</code></pre>
<pre><code>## This is mgcv 1.9-1. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb439-1" tabindex="-1"></a><span class="fu">data</span>(testisDK)</span>
<span id="cb439-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb439-2" tabindex="-1"></a><span class="fu">str</span>(testisDK)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    4860 obs. of  4 variables:
##  $ A: num  0 1 2 3 4 5 6 7 8 9 ...
##  $ P: num  1943 1943 1943 1943 1943 ...
##  $ D: num  1 1 0 1 0 0 0 0 0 0 ...
##  $ Y: num  39650 36943 34588 33267 32614 ...</code></pre>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb441-1" tabindex="-1"></a><span class="fu">summary</span>(testisDK)</span></code></pre></div>
<pre><code>##        A              P              D                Y          
##  Min.   : 0.0   Min.   :1943   Min.   : 0.000   Min.   :  471.7  
##  1st Qu.:22.0   1st Qu.:1956   1st Qu.: 0.000   1st Qu.:18482.2  
##  Median :44.5   Median :1970   Median : 1.000   Median :28636.0  
##  Mean   :44.5   Mean   :1970   Mean   : 1.812   Mean   :26239.8  
##  3rd Qu.:67.0   3rd Qu.:1983   3rd Qu.: 2.000   3rd Qu.:36785.5  
##  Max.   :89.0   Max.   :1996   Max.   :17.000   Max.   :47226.8</code></pre>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb443-1" tabindex="-1"></a><span class="fu">head</span>(testisDK)</span></code></pre></div>
<pre><code>##   A    P D        Y
## 1 0 1943 1 39649.50
## 2 1 1943 1 36942.83
## 3 2 1943 0 34588.33
## 4 3 1943 1 33267.00
## 5 4 1943 0 32614.00
## 6 5 1943 0 32020.33</code></pre>
<ul>
<li>There are nearly 5000 observations from 90 one-year age groups
and 54 calendar years. To get a clearer picture of what’s going on,
we do some housekeeping. The age range will be limited to 15-79
years, and age and period are both categorized into 5-year intervals
<ul>
<li>according to the time-honoured practice in epidemiology.</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-1" tabindex="-1"></a>tdk <span class="ot">&lt;-</span> <span class="fu">subset</span>(testisDK, A <span class="sc">&gt;</span> <span class="dv">14</span> <span class="sc">&amp;</span> A <span class="sc">&lt;</span> <span class="dv">80</span>)</span>
<span id="cb445-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-2" tabindex="-1"></a>tdk<span class="sc">$</span>Age <span class="ot">&lt;-</span> <span class="fu">cut</span>(tdk<span class="sc">$</span>A, <span class="at">br =</span> <span class="dv">5</span> <span class="sc">*</span> (<span class="dv">3</span><span class="sc">:</span><span class="dv">16</span>), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb445-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-3" tabindex="-1"></a>nAge <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(tdk<span class="sc">$</span>Age))</span>
<span id="cb445-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-4" tabindex="-1"></a>tdk<span class="sc">$</span>Per <span class="ot">&lt;-</span> <span class="fu">cut</span>(tdk<span class="sc">$</span>P,</span>
<span id="cb445-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-5" tabindex="-1"></a>  <span class="at">br =</span> <span class="fu">seq</span>(<span class="dv">1943</span>, <span class="dv">1998</span>, <span class="at">by =</span> <span class="dv">5</span>),</span>
<span id="cb445-6"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-6" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span>, <span class="at">right =</span> <span class="cn">FALSE</span>)</span>
<span id="cb445-7"><a href="poisson-regression-analysis-of-curved-effects.html#cb445-7" tabindex="-1"></a>nPer <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">levels</span>(tdk<span class="sc">$</span>Per))</span></code></pre></div>
</div>
<div id="some-descriptive-analysis" class="section level2 hasAnchor" number="8.2">
<h2><span class="header-section-number">8.2</span> Some descriptive analysis<a href="poisson-regression-analysis-of-curved-effects.html#some-descriptive-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Computation and tabulation of incidence rates</p>
<ul>
<li>Tabulate numbers of cases and person-years, and compute the
incidence rates (per 100,000 y) in each 5 y <span class="math inline">\(\times\)</span> 5 y cell using
<code>stat.table()</code>. Take a look at the structure of the thus created object</li>
</ul>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-1" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">stat.table</span>(</span>
<span id="cb446-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-2" tabindex="-1"></a>  <span class="at">index =</span> <span class="fu">list</span>(Age, Per),</span>
<span id="cb446-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-3" tabindex="-1"></a>  <span class="at">contents =</span> <span class="fu">list</span>(</span>
<span id="cb446-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-4" tabindex="-1"></a>    <span class="at">D =</span> <span class="fu">sum</span>(D),</span>
<span id="cb446-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-5" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">sum</span>(Y <span class="sc">/</span> <span class="dv">1000</span>),</span>
<span id="cb446-6"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-6" tabindex="-1"></a>    <span class="at">rate =</span> <span class="fu">ratio</span>(D, Y, <span class="dv">10</span><span class="sc">^</span><span class="dv">5</span>)</span>
<span id="cb446-7"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-7" tabindex="-1"></a>  ),</span>
<span id="cb446-8"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-8" tabindex="-1"></a>  <span class="at">margins =</span> <span class="cn">TRUE</span>,</span>
<span id="cb446-9"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-9" tabindex="-1"></a>  <span class="at">data =</span> tdk</span>
<span id="cb446-10"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-10" tabindex="-1"></a>)</span>
<span id="cb446-11"><a href="poisson-regression-analysis-of-curved-effects.html#cb446-11" tabindex="-1"></a><span class="fu">str</span>(tab)</span></code></pre></div>
<pre><code>##  &#39;stat.table&#39; num [1:3, 1:14, 1:12] 10 773.81 1.29 30 813.02 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ contents: Named chr [1:3] &quot;D&quot; &quot;Y&quot; &quot;rate&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;D&quot; &quot;Y&quot; &quot;rate&quot;
##   ..$ Age     : chr [1:14] &quot;[15,20)&quot; &quot;[20,25)&quot; &quot;[25,30)&quot; &quot;[30,35)&quot; ...
##   ..$ Per     : chr [1:12] &quot;[1943,1948)&quot; &quot;[1948,1953)&quot; &quot;[1953,1958)&quot; &quot;[1958,1963)&quot; ...
##  - attr(*, &quot;table.fun&quot;)= chr [1:3] &quot;sum&quot; &quot;sum&quot; &quot;ratio&quot;</code></pre>
<p>The table is too wide to be readable as such. A graphical
presentation is morew informative.</p>
<ul>
<li>From the saved table object <code>tab</code> you can plot an
age-incidence curve for each period separately, after you have
checked the structure of the table, so that you know the relevant
dimensions in it. There is a function <code>rateplot()</code> in <code>Epi</code>
that does default plotting of tables of rates (see the help page of
<code>rateplot</code>)</li>
</ul>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb448-1" tabindex="-1"></a><span class="fu">str</span>(tab)</span></code></pre></div>
<pre><code>##  &#39;stat.table&#39; num [1:3, 1:14, 1:12] 10 773.81 1.29 30 813.02 ...
##  - attr(*, &quot;dimnames&quot;)=List of 3
##   ..$ contents: Named chr [1:3] &quot;D&quot; &quot;Y&quot; &quot;rate&quot;
##   .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;D&quot; &quot;Y&quot; &quot;rate&quot;
##   ..$ Age     : chr [1:14] &quot;[15,20)&quot; &quot;[20,25)&quot; &quot;[25,30)&quot; &quot;[30,35)&quot; ...
##   ..$ Per     : chr [1:12] &quot;[1943,1948)&quot; &quot;[1948,1953)&quot; &quot;[1953,1958)&quot; &quot;[1958,1963)&quot; ...
##  - attr(*, &quot;table.fun&quot;)= chr [1:3] &quot;sum&quot; &quot;sum&quot; &quot;ratio&quot;</code></pre>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb450-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb450-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb450-2" tabindex="-1"></a><span class="fu">rateplot</span>(</span>
<span id="cb450-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb450-3" tabindex="-1"></a>  <span class="at">rates =</span> tab[<span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span>nAge, <span class="dv">1</span><span class="sc">:</span>nPer], <span class="at">which =</span> <span class="st">&quot;ap&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">30</span>),</span>
<span id="cb450-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb450-4" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">15</span>, <span class="dv">75</span>, <span class="dv">5</span>), <span class="at">per =</span> <span class="fu">seq</span>(<span class="dv">1943</span>, <span class="dv">1993</span>, <span class="dv">5</span>),</span>
<span id="cb450-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb450-5" tabindex="-1"></a>  <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">16</span>), <span class="at">ann =</span> <span class="cn">TRUE</span></span>
<span id="cb450-6"><a href="poisson-regression-analysis-of-curved-effects.html#cb450-6" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/plot-rates-1.png" width="672" />
Whan can you conclude about the trend in age-specific incidence rates
over calendar time? What about the effect of age?
Is there any common pattern in the age-incidence curves across the periods?</p>
</div>
<div id="age-and-period-as-categorical-factors" class="section level2 hasAnchor" number="8.3">
<h2><span class="header-section-number">8.3</span> Age and period as categorical factors<a href="poisson-regression-analysis-of-curved-effects.html#age-and-period-as-categorical-factors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We shall first fit a Poisson regression model with log link
on age and period model in the traditional way,
in which both factors are treated as categorical.
The model is additive on the log-rate scale.
It is useful to scale the person-years to be expressed in <span class="math inline">\(10^5\)</span> y.
In fitting the model we utilize the <code>poisreg</code> family object
found in package <code>Epi</code>.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb451-1" tabindex="-1"></a>tdk<span class="sc">$</span>Y <span class="ot">&lt;-</span> tdk<span class="sc">$</span>Y <span class="sc">/</span> <span class="dv">100000</span></span>
<span id="cb451-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb451-2" tabindex="-1"></a>mCat <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(D, Y) <span class="sc">~</span> Age <span class="sc">+</span> Per,</span>
<span id="cb451-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb451-3" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisreg</span>(<span class="at">link =</span> log), <span class="at">data =</span> tdk )</span>
<span id="cb451-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb451-4" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">ci.exp</span>(mCat), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                exp(Est.) 2.5% 97.5%
## (Intercept)         1.47 1.26  1.72
## Age[20,25)          3.13 2.75  3.56
## Age[25,30)          4.90 4.33  5.54
## Age[30,35)          5.50 4.87  6.22
## Age[35,40)          4.78 4.22  5.42
## Age[40,45)          3.66 3.22  4.16
## Age[45,50)          2.60 2.27  2.97
## Age[50,55)          1.94 1.68  2.25
## Age[55,60)          1.47 1.25  1.72
## Age[60,65)          0.98 0.82  1.18
## Age[65,70)          0.92 0.76  1.12
## Age[70,75)          0.90 0.73  1.12
## Age[75,80]          0.86 0.67  1.11
## Per[1948,1953)      1.12 0.96  1.30
## Per[1953,1958)      1.30 1.13  1.50
## Per[1958,1963)      1.53 1.33  1.76
## Per[1963,1968)      1.68 1.47  1.92
## Per[1968,1973)      1.98 1.74  2.25
## Per[1973,1978)      2.33 2.05  2.64
## Per[1978,1983)      2.66 2.35  3.01
## Per[1983,1988)      2.83 2.50  3.20
## Per[1988,1993)      3.08 2.73  3.47
## Per[1993,1998]      3.31 2.93  3.74</code></pre>
<p>What do the estimated rate ratios tell about the age and period effects?</p>
<ul>
<li>A graphical inspection of point estimates and confidence
intervals can be obtained as follows. In the beginning it is useful
to define shorthands for the pertinent mid-age and mid-period values
of the different intervals</li>
</ul>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-1" tabindex="-1"></a>aMid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fl">17.5</span>, <span class="fl">77.5</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb453-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-2" tabindex="-1"></a>pMid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1945</span>, <span class="dv">1995</span>, <span class="at">by =</span> <span class="dv">5</span>)</span>
<span id="cb453-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-3" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb453-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-4" tabindex="-1"></a><span class="fu">matplot</span>(aMid, <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">ci.exp</span>(mCat)[<span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>, ]), <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>,     </span>
<span id="cb453-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-5" tabindex="-1"></a>   <span class="at">log =</span> <span class="st">&quot;y&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb453-6"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-6" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Age (years)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rate ratio&quot;</span> )</span>
<span id="cb453-7"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-7" tabindex="-1"></a><span class="fu">matplot</span>(pMid, <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">ci.exp</span>(mCat)[<span class="dv">14</span><span class="sc">:</span><span class="dv">23</span>, ]), <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>,</span>
<span id="cb453-8"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-8" tabindex="-1"></a>  <span class="at">log =</span> <span class="st">&quot;y&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb453-9"><a href="poisson-regression-analysis-of-curved-effects.html#cb453-9" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Calendar year - 1900&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rate ratio&quot;</span> )</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mCat-est-1.png" width="672" />
- In the fitted model the reference category for each factor was
the first one. As age is the dominating factor, it may be more
informative to remove the intercept from the model. As a
consequence the age effects describe fitted rates at the reference
level of the period factor. For the latter one could choose the
middle period 1968-72.</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb454-1" tabindex="-1"></a>tdk<span class="sc">$</span>Per70 <span class="ot">&lt;-</span> <span class="fu">Relevel</span>(tdk<span class="sc">$</span>Per, <span class="at">ref =</span> <span class="dv">6</span>)</span>
<span id="cb454-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb454-2" tabindex="-1"></a>mCat2 <span class="ot">&lt;-</span> <span class="fu">glm</span>(<span class="fu">cbind</span>(D, Y) <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> Age <span class="sc">+</span> Per70,</span>
<span id="cb454-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb454-3" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisreg</span>(<span class="at">link =</span> log), <span class="at">data =</span> tdk )</span>
<span id="cb454-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb454-4" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">ci.exp</span>(mCat2), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                  exp(Est.)  2.5% 97.5%
## Age[15,20)            2.91  2.55  3.33
## Age[20,25)            9.12  8.31 10.01
## Age[25,30)           14.28 13.11 15.55
## Age[30,35)           16.03 14.72 17.46
## Age[35,40)           13.94 12.76 15.23
## Age[40,45)           10.66  9.71 11.71
## Age[45,50)            7.57  6.83  8.39
## Age[50,55)            5.67  5.05  6.36
## Age[55,60)            4.28  3.75  4.88
## Age[60,65)            2.85  2.43  3.35
## Age[65,70)            2.68  2.25  3.19
## Age[70,75)            2.63  2.16  3.20
## Age[75,80]            2.51  1.98  3.18
## Per70[1943,1948)      0.51  0.44  0.58
## Per70[1948,1953)      0.57  0.50  0.64
## Per70[1953,1958)      0.66  0.58  0.74
## Per70[1958,1963)      0.77  0.69  0.87
## Per70[1963,1968)      0.85  0.76  0.95
## Per70[1973,1978)      1.18  1.07  1.30
## Per70[1978,1983)      1.35  1.22  1.48
## Per70[1983,1988)      1.43  1.30  1.57
## Per70[1988,1993)      1.56  1.42  1.70
## Per70[1993,1998]      1.67  1.53  1.84</code></pre>
<p>Let us also plot estimates from the latter model, too.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb456-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-2" tabindex="-1"></a><span class="fu">matplot</span>(aMid, <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">ci.exp</span>(mCat2)[<span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>, ]), <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>,     </span>
<span id="cb456-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-3" tabindex="-1"></a>   <span class="at">log =</span> <span class="st">&quot;y&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb456-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-4" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Age (years)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rate ratio&quot;</span> )</span>
<span id="cb456-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-5" tabindex="-1"></a><span class="fu">matplot</span>(pMid, <span class="fu">rbind</span>(<span class="fu">ci.exp</span>(mCat2)[<span class="dv">14</span><span class="sc">:</span><span class="dv">18</span>, ], <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="fu">ci.exp</span>(mCat2)[<span class="dv">19</span><span class="sc">:</span><span class="dv">23</span>, ]),</span>
<span id="cb456-6"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-6" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">log =</span> <span class="st">&quot;y&quot;</span>, <span class="at">cex.lab =</span> <span class="fl">1.5</span>, <span class="at">cex.axis =</span> <span class="fl">1.5</span>,</span>
<span id="cb456-7"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-7" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;blue&quot;</span>),</span>
<span id="cb456-8"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-8" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Calendar year - 1900&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rate ratio&quot;</span> )</span>
<span id="cb456-9"><a href="poisson-regression-analysis-of-curved-effects.html#cb456-9" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;gray&quot;</span>)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mCat2-plot-1.png" width="672" /></p>
</div>
<div id="generalized-additive-model-with-penalized-splines" class="section level2 hasAnchor" number="8.4">
<h2><span class="header-section-number">8.4</span> Generalized additive model with penalized splines<a href="poisson-regression-analysis-of-curved-effects.html#generalized-additive-model-with-penalized-splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is obvious that the age effect on the log-rate scale is highly
non-linear. Yet, it is less clear whether the true period effect
deviates from linearity. Nevertheless, there are good reasons to
try fitting smooth continuous functions for both time scales.</p>
<ul>
<li>As the next task we fit a generalized additive model for the
log-rate on continuous age and period applying penalized splines
with default settings of function <code>gam()</code> in package
<code>mgcv</code>. In this fitting an <em>optimal</em> value for the penalty
parameter is chosen based on an AIC-like criterion known as UBRE.</li>
</ul>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb457-1" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb457-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb457-2" tabindex="-1"></a>mPen <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="fu">cbind</span>(D, Y) <span class="sc">~</span> <span class="fu">s</span>(A) <span class="sc">+</span> <span class="fu">s</span>(P),</span>
<span id="cb457-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb457-3" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisreg</span>(<span class="at">link =</span> log), <span class="at">data =</span> tdk</span>
<span id="cb457-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb457-4" tabindex="-1"></a>)</span>
<span id="cb457-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb457-5" tabindex="-1"></a><span class="fu">summary</span>(mPen)</span></code></pre></div>
<pre><code>## 
## Family: poisson 
## Link function: log 
## 
## Formula:
## cbind(D, Y) ~ s(A) + s(P)
## 
## Parametric coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.70960    0.01793   95.33   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##        edf Ref.df Chi.sq p-value    
## s(A) 8.143  8.765   2560  &lt;2e-16 ***
## s(P) 3.046  3.790   1054  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.598   Deviance explained = 53.6%
## UBRE = 0.082051  Scale est. = 1         n = 3510</code></pre>
<p>The summary is quite brief, and the only estimated coefficient is the
intercept, which sets the baseline level for the log-rates, against
which the relative age effects and period effects will be contrasted.
On the rate scale the baseline level 5.53 per 100000 y is obtained by
<code>exp(1.7096)</code>.</p>
<ul>
<li>See also the default plot for the fitted curves (solid lines)
describing the age and the period effects which are interpreted as
contrasts to the baseline level on the log-rate scale.</li>
</ul>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb459-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb459-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb459-2" tabindex="-1"></a><span class="fu">plot</span>(mPen, <span class="at">seWithMean =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mPen-plot-1.png" width="672" />
The dashed lines describe the 95% confidence band for the pertinent
curve. One could get the impression that year 1968 would be some kind
of reference value for the period effect, like period 1968-72
chosen as the reference in the categorical
model previously fitted. This is not the case, however, because
<code>gam()</code> by default parametrizes the spline effects such that the
reference level, at which the spline effect is nominally zero, is the
overall <em>grand mean</em> value of the log-rate in the data. This
corresponds to the principle of <em>sum contrasts</em> (<code>contr.sum</code>)
for categorical explanatory factors.</p>
<!-- % The confidence band indicates, namely, that there is uncertainty -->
<!-- % about the true age effect curve about the overall (*grand mean*) -->
<!-- % log-rate both in vertical and in horizontal direction, and there is -->
<!-- % no fixed reference level. -->
<p>From the summary you will also find that the degrees of freedom value
required for the age effect is nearly the same as the default
dimension <span class="math inline">\(k-1 = 9\)</span> of the part of the model matrix (or basis)
initially allocated for each smooth function. (Here <span class="math inline">\(k\)</span> refers to the
relevant argument that determines the basis dimension when specifying
a smooth term by <code>s()</code> in the model formula). On the other
hand the period effect takes just about 3 df.</p>
<ul>
<li>It is a good idea to do some diagnostic checking of the fitted
model</li>
</ul>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb460-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb460-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb460-2" tabindex="-1"></a><span class="fu">gam.check</span>(mPen)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mPen-check-1.png" width="672" /></p>
<pre><code>## 
## Method: UBRE   Optimizer: outer newton
## full convergence after 7 iterations.
## Gradient range [-9.390731e-10,1.362468e-06]
## (score 0.0820511 &amp; scale 1).
## Hessian positive definite, eigenvalue range [0.0002209238,0.0003824007].
## Model rank =  19 / 19 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##        k&#39;  edf k-index p-value   
## s(A) 9.00 8.14    0.93   0.010 **
## s(P) 9.00 3.05    0.95   0.075 . 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>The four diagnostic plots are analogous to some of those used in
the context of linear models for Gaussian responses, but not all of them
may be as easy to interpret. - Pay attention to the note
given in the printed output about the value of <code>k</code>.</p>
<ul>
<li>Let us refit the model but now with an increased <code>k</code> for age:</li>
</ul>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb462-1" tabindex="-1"></a>mPen2 <span class="ot">&lt;-</span> mgcv<span class="sc">::</span><span class="fu">gam</span>(<span class="fu">cbind</span>(D, Y) <span class="sc">~</span> <span class="fu">s</span>(A, <span class="at">k =</span> <span class="dv">20</span>) <span class="sc">+</span> <span class="fu">s</span>(P),</span>
<span id="cb462-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb462-2" tabindex="-1"></a>  <span class="at">family =</span> <span class="fu">poisreg</span>(<span class="at">link =</span> log), <span class="at">data =</span> tdk</span>
<span id="cb462-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb462-3" tabindex="-1"></a>)</span>
<span id="cb462-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb462-4" tabindex="-1"></a><span class="fu">summary</span>(mPen2)</span></code></pre></div>
<pre><code>## 
## Family: poisson 
## Link function: log 
## 
## Formula:
## cbind(D, Y) ~ s(A, k = 20) + s(P)
## 
## Parametric coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.70863    0.01795   95.17   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Approximate significance of smooth terms:
##         edf Ref.df Chi.sq p-value    
## s(A) 11.132 13.406   2553  &lt;2e-16 ***
## s(P)  3.045  3.788   1054  &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## R-sq.(adj) =  0.599   Deviance explained = 53.7%
## UBRE = 0.081809  Scale est. = 1         n = 3510</code></pre>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb464-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb464-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb464-2" tabindex="-1"></a><span class="fu">gam.check</span>(mPen2)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mPen2-1.png" width="672" /></p>
<pre><code>## 
## Method: UBRE   Optimizer: outer newton
## full convergence after 6 iterations.
## Gradient range [-2.397829e-12,2.90395e-09]
## (score 0.08180917 &amp; scale 1).
## Hessian positive definite, eigenvalue range [0.00022158,0.0009322215].
## Model rank =  29 / 29 
## 
## Basis dimension (k) checking results. Low p-value (k-index&lt;1) may
## indicate that k is too low, especially if edf is close to k&#39;.
## 
##         k&#39;   edf k-index p-value    
## s(A) 19.00 11.13    0.93  &lt;2e-16 ***
## s(P)  9.00  3.05    0.95   0.095 .  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>With this choice of <code>k</code> the df value for age became about 11,
which is well below <span class="math inline">\(k-1 = 19\)</span>. Let us plot the fitted curves from
this fitting, too</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb466-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb466-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb466-2" tabindex="-1"></a><span class="fu">plot</span>(mPen2, <span class="at">seWithMean =</span> <span class="cn">TRUE</span>)</span>
<span id="cb466-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb466-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1968</span>, <span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mPen2-plot-1.png" width="672" />
There does not seem to have happened any essential changes from the
previously fitted curves, so maybe 8 df could, after all, be quite
enough for the age effect.</p>
<ul>
<li>Graphical presentation of the effects using <code>plot.gam()</code>
can be improved. For instance, we may present the
age effect to describe the <em>mean</em> incidence rates by age, averaged
over the whole time span of 54 years. This is obtained by adding
the estimated intercept
to the estimated smooth curve for the age effect and showing
the antilogarithms of the ordinates of the curve.
For that purpose we need to extract the intercept and modify the
labels of the <span class="math inline">\(y\)</span>-axis accordingly. The estimated period curve
can also be expressed in terms of
relative indidence rates in relation to the fitted baseline rate,
as determined by the model intercept.</li>
</ul>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb467-2"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-2" tabindex="-1"></a>icpt <span class="ot">&lt;-</span> <span class="fu">coef</span>(mPen2)[<span class="dv">1</span>] <span class="co">#  estimated intecept</span></span>
<span id="cb467-3"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-3" tabindex="-1"></a><span class="fu">plot</span>(mPen2,</span>
<span id="cb467-4"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-4" tabindex="-1"></a>  <span class="at">seWithMean =</span> <span class="cn">TRUE</span>, <span class="at">select =</span> <span class="dv">1</span>, <span class="at">rug =</span> <span class="cn">FALSE</span>,</span>
<span id="cb467-5"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-5" tabindex="-1"></a>  <span class="at">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="dv">1</span>), <span class="fu">log</span>(<span class="dv">20</span>)) <span class="sc">-</span> icpt,</span>
<span id="cb467-6"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-6" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Age (y)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Mean rate (/100000 y)&quot;</span></span>
<span id="cb467-7"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-7" tabindex="-1"></a>)</span>
<span id="cb467-8"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-8" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>)) <span class="sc">-</span> icpt, <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">20</span>))</span>
<span id="cb467-9"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-9" tabindex="-1"></a><span class="fu">plot</span>(mPen2,</span>
<span id="cb467-10"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-10" tabindex="-1"></a>  <span class="at">seWithMean =</span> <span class="cn">TRUE</span>, <span class="at">select =</span> <span class="dv">2</span>, <span class="at">rug =</span> <span class="cn">FALSE</span>,</span>
<span id="cb467-11"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-11" tabindex="-1"></a>  <span class="at">yaxt =</span> <span class="st">&quot;n&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fu">log</span>(<span class="fl">0.4</span>), <span class="fu">log</span>(<span class="dv">2</span>)),</span>
<span id="cb467-12"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-12" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">&quot;Calendat year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Relative rate&quot;</span></span>
<span id="cb467-13"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-13" tabindex="-1"></a>)</span>
<span id="cb467-14"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-14" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="at">at =</span> <span class="fu">log</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>)), <span class="at">labels =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>, <span class="fl">1.5</span>, <span class="dv">2</span>))</span>
<span id="cb467-15"><a href="poisson-regression-analysis-of-curved-effects.html#cb467-15" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="dv">1968</span>, <span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="cont-eff-s_files/figure-html/mPen2-newplot-1.png" width="672" /></p>
<p><strong>Homework</strong>
You could continue the analysis of these data by fitting an age-cohort
model as an alternative to the age-period model, as well as an
age-cohort-period model utilizing function <code>apc.fit()</code> in
<code>Epi</code>. See (<a href="http://bendixcarstensen.com/APC/" class="uri">http://bendixcarstensen.com/APC/</a>) for details.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estimation-of-effects-simple-and-more-complex.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="causal-inference.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/SPE-R/SPE/edit/master/pracs-book/cont-eff-s.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SPE-R-2024-practicals-with-solutions.pdf", "SPE-R-2024-practicals-with-solutions.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
