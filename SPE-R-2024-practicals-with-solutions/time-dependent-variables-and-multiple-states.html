<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 15 Time-dependent variables and multiple states | Statistical Practice in Epidemiology with R</title>
  <meta name="description" content="This is the SPE-R 2024 exercises book" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 15 Time-dependent variables and multiple states | Statistical Practice in Epidemiology with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the SPE-R 2024 exercises book" />
  <meta name="github-repo" content="spe-r/spe" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 15 Time-dependent variables and multiple states | Statistical Practice in Epidemiology with R" />
  
  <meta name="twitter:description" content="This is the SPE-R 2024 exercises book" />
  

<meta name="author" content="Krista Fischer" />
<meta name="author" content="Martyn Plummer" />
<meta name="author" content="Janne Pitkäniemi" />
<meta name="author" content="Bendix Carstensen" />
<meta name="author" content="Damien Georges" />
<meta name="author" content="Esa Läärä" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="causal-inference-2-model-based-estimation-of-causal-estimands.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">SPE-R practicals</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="1" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html"><i class="fa fa-check"></i><b>1</b> Practice with basic R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#the-working-directory"><i class="fa fa-check"></i><b>1.1</b> The working directory</a></li>
<li class="chapter" data-level="1.2" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#the-workspace"><i class="fa fa-check"></i><b>1.2</b> The workspace</a></li>
<li class="chapter" data-level="1.3" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#using-r-as-a-calculator"><i class="fa fa-check"></i><b>1.3</b> Using R as a calculator</a></li>
<li class="chapter" data-level="1.4" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#vectors"><i class="fa fa-check"></i><b>1.4</b> Vectors</a></li>
<li class="chapter" data-level="1.5" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#sequences"><i class="fa fa-check"></i><b>1.5</b> Sequences</a></li>
<li class="chapter" data-level="1.6" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#displaying-and-changing-parts-of-a-vector-indexing"><i class="fa fa-check"></i><b>1.6</b> Displaying and changing parts of a vector (indexing)</a></li>
<li class="chapter" data-level="1.7" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#lists"><i class="fa fa-check"></i><b>1.7</b> Lists</a></li>
<li class="chapter" data-level="1.8" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#data-frames"><i class="fa fa-check"></i><b>1.8</b> Data frames</a></li>
<li class="chapter" data-level="1.9" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#working-with-built-in-data-frames"><i class="fa fa-check"></i><b>1.9</b> Working with built-in data frames</a></li>
<li class="chapter" data-level="1.10" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#referencing-parts-of-the-data-frame-indexing"><i class="fa fa-check"></i><b>1.10</b> Referencing parts of the data frame (indexing)</a></li>
<li class="chapter" data-level="1.11" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#summaries"><i class="fa fa-check"></i><b>1.11</b> Summaries</a></li>
<li class="chapter" data-level="1.12" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#generating-new-variables"><i class="fa fa-check"></i><b>1.12</b> Generating new variables</a></li>
<li class="chapter" data-level="1.13" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#turning-a-variable-into-a-factor"><i class="fa fa-check"></i><b>1.13</b> Turning a variable into a factor</a></li>
<li class="chapter" data-level="1.14" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#frequency-tables"><i class="fa fa-check"></i><b>1.14</b> Frequency tables</a></li>
<li class="chapter" data-level="1.15" data-path="practice-with-basic-r.html"><a href="practice-with-basic-r.html#grouping-the-values-of-a-numeric-variable"><i class="fa fa-check"></i><b>1.15</b> Grouping the values of a numeric variable</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html"><i class="fa fa-check"></i><b>2</b> Reading data into <code>R</code></a>
<ul>
<li class="chapter" data-level="2.1" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#introduction"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#data-sources"><i class="fa fa-check"></i><b>2.2</b> Data sources</a></li>
<li class="chapter" data-level="2.3" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#data-in-text-files"><i class="fa fa-check"></i><b>2.3</b> Data in text files</a></li>
<li class="chapter" data-level="2.4" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#things-that-can-go-wrong"><i class="fa fa-check"></i><b>2.4</b> Things that can go wrong</a></li>
<li class="chapter" data-level="2.5" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#forgetting-the-headers"><i class="fa fa-check"></i><b>2.5</b> Forgetting the headers</a></li>
<li class="chapter" data-level="2.6" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#using-the-wrong-separator"><i class="fa fa-check"></i><b>2.6</b> Using the wrong separator</a></li>
<li class="chapter" data-level="2.7" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#mis-specifying-the-representation-of-missing-values"><i class="fa fa-check"></i><b>2.7</b> Mis-specifying the representation of missing values</a></li>
<li class="chapter" data-level="2.8" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#spreadsheet-data"><i class="fa fa-check"></i><b>2.8</b> Spreadsheet data</a></li>
<li class="chapter" data-level="2.9" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#reading-data-from-the-internet"><i class="fa fa-check"></i><b>2.9</b> Reading data from the Internet</a></li>
<li class="chapter" data-level="2.10" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#reading-from-the-clipboard"><i class="fa fa-check"></i><b>2.10</b> Reading from the clipboard</a></li>
<li class="chapter" data-level="2.11" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#binary-data"><i class="fa fa-check"></i><b>2.11</b> Binary data</a></li>
<li class="chapter" data-level="2.12" data-path="reading-data-into-r.html"><a href="reading-data-into-r.html#summary"><i class="fa fa-check"></i><b>2.12</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Data manipulation with <code>tidyverse</code></a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#the-births-data"><i class="fa fa-check"></i><b>3.2</b> The <code>births</code> data</a></li>
<li class="chapter" data-level="3.3" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#tibble-vs-data.frame"><i class="fa fa-check"></i><b>3.3</b> <code>tibble</code> vs <code>data.frame</code></a></li>
<li class="chapter" data-level="3.4" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#piping-functions"><i class="fa fa-check"></i><b>3.4</b> Piping functions</a></li>
<li class="chapter" data-level="3.5" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#mutate-columns"><i class="fa fa-check"></i><b>3.5</b> <code>mutate</code> columns</a></li>
<li class="chapter" data-level="3.6" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#select-columns-filter-and-arrange-rows"><i class="fa fa-check"></i><b>3.6</b> <code>select</code> columns, <code>filter</code> and <code>arrange</code> rows</a></li>
<li class="chapter" data-level="3.7" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#group_by-and-summarise-data"><i class="fa fa-check"></i><b>3.7</b> <code>group_by</code> and <code>summarise</code> data</a></li>
<li class="chapter" data-level="3.8" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#multiple-grouping"><i class="fa fa-check"></i><b>3.8</b> Multiple grouping</a></li>
<li class="chapter" data-level="3.9" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#bind-and-join-tables"><i class="fa fa-check"></i><b>3.9</b> Bind and join tables</a></li>
<li class="chapter" data-level="3.10" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#data-visualization-with-ggplot2"><i class="fa fa-check"></i><b>3.10</b> Data Visualization with ggplot2</a></li>
<li class="chapter" data-level="3.11" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#pivoting-data-with-tidyr"><i class="fa fa-check"></i><b>3.11</b> pivoting data with tidyr</a></li>
<li class="chapter" data-level="3.12" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#reading-files-with-readr"><i class="fa fa-check"></i><b>3.12</b> reading files with readr</a></li>
<li class="chapter" data-level="3.13" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#string-manipulation-with-stringr"><i class="fa fa-check"></i><b>3.13</b> String manipulation with stringr</a></li>
<li class="chapter" data-level="3.14" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#purrr-package-to-apply-functions-to-list"><i class="fa fa-check"></i><b>3.14</b> purrr package to apply functions to list</a></li>
<li class="chapter" data-level="3.15" data-path="data-manipulation-with-tidyverse.html"><a href="data-manipulation-with-tidyverse.html#bonus-rendering-tables"><i class="fa fa-check"></i><b>3.15</b> Bonus: Rendering tables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tabulation.html"><a href="tabulation.html"><i class="fa fa-check"></i><b>4</b> Tabulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tabulation.html"><a href="tabulation.html#introduction-2"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="tabulation.html"><a href="tabulation.html#the-births-data-1"><i class="fa fa-check"></i><b>4.2</b> The births data</a></li>
<li class="chapter" data-level="4.3" data-path="tabulation.html"><a href="tabulation.html#one-way-tables"><i class="fa fa-check"></i><b>4.3</b> One-way tables</a></li>
<li class="chapter" data-level="4.4" data-path="tabulation.html"><a href="tabulation.html#improving-the-presentation-of-tables"><i class="fa fa-check"></i><b>4.4</b> Improving the Presentation of Tables</a></li>
<li class="chapter" data-level="4.5" data-path="tabulation.html"><a href="tabulation.html#two-way-tables"><i class="fa fa-check"></i><b>4.5</b> Two-way Tables</a></li>
<li class="chapter" data-level="4.6" data-path="tabulation.html"><a href="tabulation.html#printing"><i class="fa fa-check"></i><b>4.6</b> Printing</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics-in-r.html"><a href="graphics-in-r.html"><i class="fa fa-check"></i><b>5</b> Graphics in R</a>
<ul>
<li class="chapter" data-level="5.1" data-path="graphics-in-r.html"><a href="graphics-in-r.html#simple-plot-on-the-screen"><i class="fa fa-check"></i><b>5.1</b> Simple plot on the screen</a></li>
<li class="chapter" data-level="5.2" data-path="graphics-in-r.html"><a href="graphics-in-r.html#colours"><i class="fa fa-check"></i><b>5.2</b> Colours</a></li>
<li class="chapter" data-level="5.3" data-path="graphics-in-r.html"><a href="graphics-in-r.html#adding-to-a-plot"><i class="fa fa-check"></i><b>5.3</b> Adding to a plot</a></li>
<li class="chapter" data-level="5.4" data-path="graphics-in-r.html"><a href="graphics-in-r.html#using-indexing-for-plot-elements"><i class="fa fa-check"></i><b>5.4</b> Using indexing for plot elements</a></li>
<li class="chapter" data-level="5.5" data-path="graphics-in-r.html"><a href="graphics-in-r.html#generating-colours"><i class="fa fa-check"></i><b>5.5</b> Generating colours</a></li>
<li class="chapter" data-level="5.6" data-path="graphics-in-r.html"><a href="graphics-in-r.html#saving-your-graphs-for-use-in-other-documents"><i class="fa fa-check"></i><b>5.6</b> Saving your graphs for use in other documents</a></li>
<li class="chapter" data-level="5.7" data-path="graphics-in-r.html"><a href="graphics-in-r.html#interacting-with-a-plot"><i class="fa fa-check"></i><b>5.7</b> Interacting with a plot</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><i class="fa fa-check"></i><b>6</b> Analysis of hazard rates, their ratios and differences and binary regression</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#hand-calculations-for-a-single-rate"><i class="fa fa-check"></i><b>6.1</b> Hand calculations for a single rate</a></li>
<li class="chapter" data-level="6.2" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#poisson-model-for-a-single-rate-with-logarithmic-link"><i class="fa fa-check"></i><b>6.2</b> Poisson model for a single rate with logarithmic link</a></li>
<li class="chapter" data-level="6.3" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#poisson-model-for-a-single-rate-with-identity-link"><i class="fa fa-check"></i><b>6.3</b> Poisson model for a single rate with identity link</a></li>
<li class="chapter" data-level="6.4" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#poisson-model-assuming-the-same-rate-for-several-periods"><i class="fa fa-check"></i><b>6.4</b> Poisson model assuming the same rate for several periods</a></li>
<li class="chapter" data-level="6.5" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#analysis-of-rate-ratio"><i class="fa fa-check"></i><b>6.5</b> Analysis of rate ratio</a></li>
<li class="chapter" data-level="6.6" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#analysis-of-rate-difference"><i class="fa fa-check"></i><b>6.6</b> Analysis of rate difference</a></li>
<li class="chapter" data-level="6.7" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#binary-regression"><i class="fa fa-check"></i><b>6.7</b> Binary regression</a></li>
<li class="chapter" data-level="6.8" data-path="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html"><a href="analysis-of-hazard-rates-their-ratios-and-differences-and-binary-regression.html#optionalhomework-hand-calculations-and-calculations-using-matrix-tools"><i class="fa fa-check"></i><b>6.8</b> Optional/Homework: Hand calculations and calculations using matrix tools</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html"><i class="fa fa-check"></i><b>7</b> Estimation of effects: simple and more complex</a>
<ul>
<li class="chapter" data-level="7.1" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#response-and-explanatory-variables"><i class="fa fa-check"></i><b>7.1</b> Response and explanatory variables</a></li>
<li class="chapter" data-level="7.2" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#data-set-births"><i class="fa fa-check"></i><b>7.2</b> Data set <code>births</code></a></li>
<li class="chapter" data-level="7.3" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#simple-estimation-with-lm-and-glm"><i class="fa fa-check"></i><b>7.3</b> Simple estimation with <code>lm()</code> and <code>glm()</code></a></li>
<li class="chapter" data-level="7.4" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#stratified-effects-and-interaction-or-effect-measure-modification"><i class="fa fa-check"></i><b>7.4</b> Stratified effects, and interaction or effect-measure modification</a></li>
<li class="chapter" data-level="7.5" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#controlling-or-adjusting-for-the-effect-of-hyp-for-sex"><i class="fa fa-check"></i><b>7.5</b> Controlling or adjusting for the effect of <code>hyp</code> for <code>sex</code></a></li>
<li class="chapter" data-level="7.6" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#numeric-exposure-simple-linear-regression-and-checking-assumptions"><i class="fa fa-check"></i><b>7.6</b> Numeric exposure, simple linear regression and checking assumptions</a></li>
<li class="chapter" data-level="7.7" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#penalized-spline-model"><i class="fa fa-check"></i><b>7.7</b> Penalized spline model</a></li>
<li class="chapter" data-level="7.8" data-path="estimation-of-effects-simple-and-more-complex.html"><a href="estimation-of-effects-simple-and-more-complex.html#analysis-of-binary-outcomes"><i class="fa fa-check"></i><b>7.8</b> Analysis of binary outcomes</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html"><i class="fa fa-check"></i><b>8</b> Poisson regression &amp; analysis of curved effects</a>
<ul>
<li class="chapter" data-level="8.1" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#testis-cancer-data-input-and-housekeeping"><i class="fa fa-check"></i><b>8.1</b> Testis cancer: Data input and housekeeping</a></li>
<li class="chapter" data-level="8.2" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#some-descriptive-analysis"><i class="fa fa-check"></i><b>8.2</b> Some descriptive analysis</a></li>
<li class="chapter" data-level="8.3" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#age-and-period-as-categorical-factors"><i class="fa fa-check"></i><b>8.3</b> Age and period as categorical factors</a></li>
<li class="chapter" data-level="8.4" data-path="poisson-regression-analysis-of-curved-effects.html"><a href="poisson-regression-analysis-of-curved-effects.html#generalized-additive-model-with-penalized-splines"><i class="fa fa-check"></i><b>8.4</b> Generalized additive model with penalized splines</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="causal-inference.html"><a href="causal-inference.html"><i class="fa fa-check"></i><b>9</b> Causal inference</a>
<ul>
<li class="chapter" data-level="9.1" data-path="causal-inference.html"><a href="causal-inference.html#proper-adjustment-for-confounding-in-regression-models"><i class="fa fa-check"></i><b>9.1</b> Proper adjustment for confounding in regression models</a></li>
<li class="chapter" data-level="9.2" data-path="causal-inference.html"><a href="causal-inference.html#dag-tools-in-the-package-dagitty"><i class="fa fa-check"></i><b>9.2</b> DAG tools in the package <code>dagitty</code></a></li>
<li class="chapter" data-level="9.3" data-path="causal-inference.html"><a href="causal-inference.html#instrumental-variables-estimation-mendelian-randomization"><i class="fa fa-check"></i><b>9.3</b> Instrumental variables estimation: Mendelian randomization</a></li>
<li class="chapter" data-level="9.4" data-path="causal-inference.html"><a href="causal-inference.html#why-are-simulation-exercises-useful-for-causal-inference"><i class="fa fa-check"></i><b>9.4</b> Why are simulation exercises useful for causal inference?</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html"><i class="fa fa-check"></i><b>10</b> Graphics with ggplot2</a>
<ul>
<li class="chapter" data-level="10.1" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#data"><i class="fa fa-check"></i><b>10.1</b> Data</a></li>
<li class="chapter" data-level="10.2" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#building-the-plot"><i class="fa fa-check"></i><b>10.2</b> Building the plot</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#the-ggplot2-package"><i class="fa fa-check"></i><b>10.2.1</b> The ggplot2 package</a></li>
<li class="chapter" data-level="10.2.2" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#geometries"><i class="fa fa-check"></i><b>10.2.2</b> Geometries</a></li>
<li class="chapter" data-level="10.2.3" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#scales"><i class="fa fa-check"></i><b>10.2.3</b> Scales</a></li>
<li class="chapter" data-level="10.2.4" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#themes"><i class="fa fa-check"></i><b>10.2.4</b> Themes</a></li>
<li class="chapter" data-level="10.2.5" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#putting-everything-together"><i class="fa fa-check"></i><b>10.2.5</b> Putting everything together</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#self-study"><i class="fa fa-check"></i><b>10.3</b> Self study</a></li>
<li class="chapter" data-level="10.4" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#adding-the-table-advanced-topic"><i class="fa fa-check"></i><b>10.4</b> Adding the table (advanced topic)</a></li>
<li class="chapter" data-level="10.5" data-path="graphics-with-ggplot2.html"><a href="graphics-with-ggplot2.html#references"><i class="fa fa-check"></i><b>10.5</b> References</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html"><i class="fa fa-check"></i><b>11</b> Survival analysis with competing risks: Oral cancer patients</a>
<ul>
<li class="chapter" data-level="11.1" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#description-of-the-data"><i class="fa fa-check"></i><b>11.1</b> Description of the data</a></li>
<li class="chapter" data-level="11.2" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#loading-the-packages-and-the-data"><i class="fa fa-check"></i><b>11.2</b> Loading the packages and the data</a></li>
<li class="chapter" data-level="11.3" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#total-mortality-kaplanmeier-analyses"><i class="fa fa-check"></i><b>11.3</b> Total mortality: Kaplan–Meier analyses</a></li>
<li class="chapter" data-level="11.4" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#total-mortality-by-stage"><i class="fa fa-check"></i><b>11.4</b> Total mortality by stage</a></li>
<li class="chapter" data-level="11.5" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#event-specific-cumulative-mortality-curves"><i class="fa fa-check"></i><b>11.5</b> Event-specific cumulative mortality curves</a></li>
<li class="chapter" data-level="11.6" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#regression-modelling-of-overall-mortality."><i class="fa fa-check"></i><b>11.6</b> Regression modelling of overall mortality.</a></li>
<li class="chapter" data-level="11.7" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#modelling-event-specific-hazards"><i class="fa fa-check"></i><b>11.7</b> Modelling event-specific hazards</a></li>
<li class="chapter" data-level="11.8" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#lexis-object-with-multi-state-set-up"><i class="fa fa-check"></i><b>11.8</b> Lexis object with multi-state set-up</a></li>
<li class="chapter" data-level="11.9" data-path="survival-analysis-with-competing-risks-oral-cancer-patients.html"><a href="survival-analysis-with-competing-risks-oral-cancer-patients.html#optional-poisson-regression-as-an-alternative-to-cox-model"><i class="fa fa-check"></i><b>11.9</b> Optional: Poisson regression as an alternative to Cox model</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html"><i class="fa fa-check"></i><b>12</b> Time-splitting, time-scales and SMR</a>
<ul>
<li class="chapter" data-level="12.1" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html#age-specific-mortality"><i class="fa fa-check"></i><b>12.1</b> Age-specific mortality</a></li>
<li class="chapter" data-level="12.2" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html#smr"><i class="fa fa-check"></i><b>12.2</b> SMR</a></li>
<li class="chapter" data-level="12.3" data-path="time-splitting-time-scales-and-smr.html"><a href="time-splitting-time-scales-and-smr.html#smr-modeling"><i class="fa fa-check"></i><b>12.3</b> SMR modeling</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><i class="fa fa-check"></i><b>13</b> Nested case-control study and case-cohort study: Risk factors of coronary heart disease</a>
<ul>
<li class="chapter" data-level="13.1" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#reading-the-cohort-data-illustrating-the-study-base-and-risk-sets"><i class="fa fa-check"></i><b>13.1</b> Reading the cohort data, illustrating the study base and risk sets</a></li>
<li class="chapter" data-level="13.2" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#nested-case-control-study"><i class="fa fa-check"></i><b>13.2</b> Nested case-control study</a></li>
<li class="chapter" data-level="13.3" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#case-cohort-study"><i class="fa fa-check"></i><b>13.3</b> Case-cohort study</a></li>
<li class="chapter" data-level="13.4" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#do-these-estimates-resemble-those-obtained-from-nested-case-control-data"><i class="fa fa-check"></i><b>13.4</b> Do these estimates resemble those obtained from nested case-control data?</a></li>
<li class="chapter" data-level="13.5" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#full-cohort-analysis-and-comparisons"><i class="fa fa-check"></i><b>13.5</b> Full cohort analysis and comparisons</a></li>
<li class="chapter" data-level="13.6" data-path="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html"><a href="nested-case-control-study-and-case-cohort-study-risk-factors-of-coronary-heart-disease.html#further-exercises-and-homework"><i class="fa fa-check"></i><b>13.6</b> Further exercises and homework</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html"><i class="fa fa-check"></i><b>14</b> Causal inference 2: Model-based estimation of causal estimands</a>
<ul>
<li class="chapter" data-level="14.1" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#control-of-confounding"><i class="fa fa-check"></i><b>14.1</b> Control of confounding</a></li>
<li class="chapter" data-level="14.2" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#generation-of-target-population-and-true-models"><i class="fa fa-check"></i><b>14.2</b> Generation of target population and true models</a></li>
<li class="chapter" data-level="14.3" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#factual-and-counterfactual-risks---associational-and-causal-contrasts"><i class="fa fa-check"></i><b>14.3</b> Factual and counterfactual risks - associational and causal contrasts</a></li>
<li class="chapter" data-level="14.4" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#outcome-modelling-and-estimation-of-causal-contrasts-by-g-formula"><i class="fa fa-check"></i><b>14.4</b> Outcome modelling and estimation of causal contrasts by g-formula</a></li>
<li class="chapter" data-level="14.5" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#inverse-probability-weighting-ipw-by-propensity-scores"><i class="fa fa-check"></i><b>14.5</b> Inverse probability weighting (IPW) by propensity scores</a></li>
<li class="chapter" data-level="14.6" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#improving-ipw-estimation-and-using-r-package-psweight"><i class="fa fa-check"></i><b>14.6</b> Improving IPW estimation and using R package <code>PSweight</code></a></li>
<li class="chapter" data-level="14.7" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#effect-of-exposure-among-those-exposed"><i class="fa fa-check"></i><b>14.7</b> Effect of exposure among those exposed</a></li>
<li class="chapter" data-level="14.8" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#augmented-ipw"><i class="fa fa-check"></i><b>14.8</b> Augmented IPW</a></li>
<li class="chapter" data-level="14.9" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#targeted-maximum-likelihood-estimation-tmle"><i class="fa fa-check"></i><b>14.9</b> Targeted maximum likelihood estimation (TMLE)</a></li>
<li class="chapter" data-level="14.10" data-path="causal-inference-2-model-based-estimation-of-causal-estimands.html"><a href="causal-inference-2-model-based-estimation-of-causal-estimands.html#tmle-with-superlearner"><i class="fa fa-check"></i><b>14.10</b> TMLE with SuperLearner</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="time-dependent-variables-and-multiple-states.html"><a href="time-dependent-variables-and-multiple-states.html"><i class="fa fa-check"></i><b>15</b> Time-dependent variables and multiple states</a>
<ul>
<li class="chapter" data-level="15.1" data-path="time-dependent-variables-and-multiple-states.html"><a href="time-dependent-variables-and-multiple-states.html#the-renal-failure-dataset"><i class="fa fa-check"></i><b>15.1</b> The renal failure dataset</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/SPE-R/SPE" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Practice in Epidemiology with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="time-dependent-variables-and-multiple-states" class="section level1 hasAnchor" number="15">
<h1><span class="header-section-number">Chapter 15</span> Time-dependent variables and multiple states<a href="time-dependent-variables-and-multiple-states.html#time-dependent-variables-and-multiple-states" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The following practical exercise is based on the data from paper:</p>
<blockquote>
<p>P Hovind, L Tarnow, P Rossing, B Carstensen, and HH Parving:
Improved survival in patients obtaining remission of nephrotic range
albuminuria in diabetic nephropathy.
<em>Kidney Int</em>, <strong>66</strong>(3):1180–1186, Sept 2004.</p>
</blockquote>
<p>You can find a <code>.pdf</code>-version of the paper here:
<a href="http://BendixCarstensen.com/AdvCoh/papers/Hovind.2004.pdf" class="uri">http://BendixCarstensen.com/AdvCoh/papers/Hovind.2004.pdf</a></p>
<div id="the-renal-failure-dataset" class="section level2 hasAnchor" number="15.1">
<h2><span class="header-section-number">15.1</span> The renal failure dataset<a href="time-dependent-variables-and-multiple-states.html#the-renal-failure-dataset" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The dataset <code>renal.dta</code> contains data on follow up of 125
patients from Steno Diabetes Center. They enter the study when they
are diagnosed with nephrotic range albuminuria (NRA). This is a
condition where the levels of albumin in the urine is exceeds a
certain level as a sign of kidney disease. The levels may however drop
as a consequence of treatment, this is called remission. Patients exit
the study at death or kidney failure (dialysis or transplant).</p>
<table>
<thead>
<tr class="header">
<th align="left">Variable</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>id</code></td>
<td align="left">Patient id</td>
</tr>
<tr class="even">
<td align="left"><code>sex</code></td>
<td align="left">1=male, 2=female</td>
</tr>
<tr class="odd">
<td align="left"><code>dob</code></td>
<td align="left">Date of birth</td>
</tr>
<tr class="even">
<td align="left"><code>doe</code></td>
<td align="left">Date of entry into the study (2.5 years after NRA)</td>
</tr>
<tr class="odd">
<td align="left"><code>dor</code></td>
<td align="left">Date of remission. Missing if no remission has occurred</td>
</tr>
<tr class="even">
<td align="left"><code>dox</code></td>
<td align="left">Date of exit from study</td>
</tr>
<tr class="odd">
<td align="left"><code>event</code></td>
<td align="left">Exit status: 1,2,3=event (death, ESRD), 0=censored</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><p>The dataset is in Stata-format, so you must read the dataset
using <code>read.dta</code> from the <code>foreign</code> package (which is
part of the standard <code>R</code>-distribution). At the same time, convert
<code>sex</code> to a proper factor. Choose where to read the dataset.</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="time-dependent-variables-and-multiple-states.html#cb730-1" tabindex="-1"></a><span class="fu">library</span>(Epi)</span>
<span id="cb730-2"><a href="time-dependent-variables-and-multiple-states.html#cb730-2" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb730-3"><a href="time-dependent-variables-and-multiple-states.html#cb730-3" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span></code></pre></div>
<pre><code>Loading required package: nlme</code></pre>
<pre><code>This is mgcv 1.9-1. For overview type &#39;help(&quot;mgcv-package&quot;)&#39;.</code></pre>
<div class="sourceCode" id="cb733"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb733-1"><a href="time-dependent-variables-and-multiple-states.html#cb733-1" tabindex="-1"></a><span class="fu">library</span>(foreign)</span>
<span id="cb733-2"><a href="time-dependent-variables-and-multiple-states.html#cb733-2" tabindex="-1"></a><span class="co"># renal &lt;- read.dta(</span></span>
<span id="cb733-3"><a href="time-dependent-variables-and-multiple-states.html#cb733-3" tabindex="-1"></a><span class="co">#  &quot;https://raw.githubusercontent.com/SPE-R/SPE/master/pracs/data/renal.dta&quot;)</span></span>
<span id="cb733-4"><a href="time-dependent-variables-and-multiple-states.html#cb733-4" tabindex="-1"></a>renal <span class="ot">&lt;-</span> <span class="fu">read.dta</span>(<span class="st">&quot;http://BendixCarstensen.com/SPE/data/renal.dta&quot;</span>)</span>
<span id="cb733-5"><a href="time-dependent-variables-and-multiple-states.html#cb733-5" tabindex="-1"></a>renal<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(renal<span class="sc">$</span>sex, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>))</span>
<span id="cb733-6"><a href="time-dependent-variables-and-multiple-states.html#cb733-6" tabindex="-1"></a><span class="fu">head</span>(renal)</span></code></pre></div></li>
<li><p>Use the <code>Lexis</code> function to declare the data as
survival data with age, calendar time and time since entry into
the study as timescales. Label any event <span class="math inline">\(&gt;0\)</span> as <em>ESRD</em>,
i.e. renal death (death of kidney (transplant or dialysis), or
person).
Note that you must make sure that the <em>alive</em> state (here
<code>NRA</code>) is the first, as <code>Lexis</code> assumes that
everyone starts in this state (unless of course
<code>entry.status</code> is specified):</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb734-1"><a href="time-dependent-variables-and-multiple-states.html#cb734-1" tabindex="-1"></a>Lr <span class="ot">&lt;-</span> <span class="fu">Lexis</span>(<span class="at">entry =</span> <span class="fu">list</span>(<span class="at">per =</span> doe,</span>
<span id="cb734-2"><a href="time-dependent-variables-and-multiple-states.html#cb734-2" tabindex="-1"></a>                         <span class="at">age =</span> doe <span class="sc">-</span> dob,</span>
<span id="cb734-3"><a href="time-dependent-variables-and-multiple-states.html#cb734-3" tabindex="-1"></a>                         <span class="at">tfi =</span> <span class="dv">0</span>),</span>
<span id="cb734-4"><a href="time-dependent-variables-and-multiple-states.html#cb734-4" tabindex="-1"></a>             <span class="at">exit =</span> <span class="fu">list</span>(<span class="at">per =</span> dox),</span>
<span id="cb734-5"><a href="time-dependent-variables-and-multiple-states.html#cb734-5" tabindex="-1"></a>      <span class="at">exit.status =</span> <span class="fu">factor</span>(event <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;NRA&quot;</span>, <span class="st">&quot;ESRD&quot;</span>)),</span>
<span id="cb734-6"><a href="time-dependent-variables-and-multiple-states.html#cb734-6" tabindex="-1"></a>             <span class="at">data =</span> renal)</span></code></pre></div>
<pre><code>NOTE: entry.status has been set to &quot;NRA&quot; for all.</code></pre>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb736-1"><a href="time-dependent-variables-and-multiple-states.html#cb736-1" tabindex="-1"></a><span class="fu">str</span>(Lr)</span></code></pre></div>
<pre><code>Classes &#39;Lexis&#39; and &#39;data.frame&#39;:   125 obs. of  14 variables:
 $ per    : num  1996 1990 1988 1995 1988 ...
 $ age    : num  28.1 30.2 25.8 44.5 26.6 ...
 $ tfi    : num  0 0 0 0 0 0 0 0 0 0 ...
 $ lex.dur: num  1.08 6.6 5.39 8.75 16.07 ...
 $ lex.Cst: Factor w/ 2 levels &quot;NRA&quot;,&quot;ESRD&quot;: 1 1 1 1 1 1 1 1 1 1 ...
 $ lex.Xst: Factor w/ 2 levels &quot;NRA&quot;,&quot;ESRD&quot;: 2 2 2 1 1 2 2 1 2 1 ...
 $ lex.id : int  1 2 3 4 5 6 7 8 9 10 ...
 $ id     : num  17 26 27 33 42 46 47 55 62 64 ...
 $ sex    : Factor w/ 2 levels &quot;M&quot;,&quot;F&quot;: 1 2 2 1 2 2 1 1 2 1 ...
 $ dob    : num  1968 1959 1962 1951 1961 ...
 $ doe    : num  1996 1990 1988 1995 1988 ...
 $ dor    : num  NA 1990 NA 1996 1997 ...
 $ dox    : num  1997 1996 1993 2004 2004 ...
 $ event  : num  2 1 3 0 0 2 1 0 2 0 ...
 - attr(*, &quot;time.scales&quot;)= chr [1:3] &quot;per&quot; &quot;age&quot; &quot;tfi&quot;
 - attr(*, &quot;time.since&quot;)= chr [1:3] &quot;&quot; &quot;&quot; &quot;&quot;
 - attr(*, &quot;breaks&quot;)=List of 3
  ..$ per: NULL
  ..$ age: NULL
  ..$ tfi: NULL</code></pre>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb738-1"><a href="time-dependent-variables-and-multiple-states.html#cb738-1" tabindex="-1"></a><span class="fu">summary</span>(Lr)</span></code></pre></div>
<pre><code>
Transitions:
     To
From  NRA ESRD  Records:  Events: Risk time:  Persons:
  NRA  48   77       125       77    1084.67       125</code></pre>
<p>Make sure you know what the variables in <code>Lr</code> stand for.</p></li>
<li><p>Visualize the follow-up in a Lexis-diagram, by using the
<code>plot</code> method for <code>Lexis</code> objects.</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb740-1"><a href="time-dependent-variables-and-multiple-states.html#cb740-1" tabindex="-1"></a><span class="fu">plot</span>(Lr, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/Lexis-ups-1.png" width="672" /></p>
<div class="sourceCode" id="cb741"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb741-1"><a href="time-dependent-variables-and-multiple-states.html#cb741-1" tabindex="-1"></a><span class="fu">subset</span>(Lr, age <span class="sc">&lt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code> lex.id     per    age tfi lex.dur lex.Cst lex.Xst  id sex      dob      doe dor      dox
     88 1989.34 -38.81   0     3.5     NRA    ESRD 586   M 2028.155 1989.343  NA 1992.839
 event
     1</code></pre>
<p>What is wrong here? List the data for the person with negative entry age.</p></li>
<li><p>Correct the data and make a new plot, for example by:</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb743-1"><a href="time-dependent-variables-and-multiple-states.html#cb743-1" tabindex="-1"></a>Lr <span class="ot">&lt;-</span> <span class="fu">transform</span>(Lr, <span class="at">age =</span> <span class="fu">ifelse</span>(dob <span class="sc">&gt;</span> <span class="dv">2000</span>, age <span class="sc">+</span> <span class="dv">100</span>, age),</span>
<span id="cb743-2"><a href="time-dependent-variables-and-multiple-states.html#cb743-2" tabindex="-1"></a>                    <span class="at">dob =</span> <span class="fu">ifelse</span>(dob <span class="sc">&gt;</span> <span class="dv">2000</span>, dob <span class="sc">-</span> <span class="dv">100</span>, dob))</span>
<span id="cb743-3"><a href="time-dependent-variables-and-multiple-states.html#cb743-3" tabindex="-1"></a><span class="fu">subset</span>(Lr, id <span class="sc">==</span> <span class="dv">586</span>)</span></code></pre></div>
<pre><code> lex.id     per   age tfi lex.dur lex.Cst lex.Xst  id sex      dob      doe dor      dox
     88 1989.34 61.19   0     3.5     NRA    ESRD 586   M 1928.155 1989.343  NA 1992.839
 event
     1</code></pre>
<div class="sourceCode" id="cb745"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb745-1"><a href="time-dependent-variables-and-multiple-states.html#cb745-1" tabindex="-1"></a><span class="fu">plot</span>(Lr, <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/Lexis-def-1.png" width="672" /></p></li>
<li><p>Now make a Cox-regression analysis of ESRD occurrence with
the variables sex and age at entry into the study, using time
since entry to the study as time scale.</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb746-1"><a href="time-dependent-variables-and-multiple-states.html#cb746-1" tabindex="-1"></a>mc <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(lex.dur, lex.Xst <span class="sc">==</span> <span class="st">&quot;ESRD&quot;</span>) </span>
<span id="cb746-2"><a href="time-dependent-variables-and-multiple-states.html#cb746-2" tabindex="-1"></a>            <span class="sc">~</span> <span class="fu">I</span>(age <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">+</span> sex, <span class="at">data =</span> Lr)</span>
<span id="cb746-3"><a href="time-dependent-variables-and-multiple-states.html#cb746-3" tabindex="-1"></a><span class="fu">summary</span>(mc)</span></code></pre></div>
<pre><code>Call:
coxph(formula = Surv(lex.dur, lex.Xst == &quot;ESRD&quot;) ~ I(age/10) + 
    sex, data = Lr)

  n= 125, number of events= 77 

             coef exp(coef) se(coef)      z Pr(&gt;|z|)
I(age/10)  0.5514    1.7357   0.1402  3.932 8.43e-05
sexF      -0.1817    0.8338   0.2727 -0.666    0.505

          exp(coef) exp(-coef) lower .95 upper .95
I(age/10)    1.7357     0.5761    1.3186     2.285
sexF         0.8338     1.1993    0.4886     1.423

Concordance= 0.612  (se = 0.036 )
Likelihood ratio test= 16.07  on 2 df,   p=3e-04
Wald test            = 16.38  on 2 df,   p=3e-04
Score (logrank) test = 16.77  on 2 df,   p=2e-04</code></pre>
<p>What is the hazard ratio between males and females?
Between two persons who differ 10 years in age at entry?</p></li>
<li><p>The main focus of the paper was to assess whether the occurrence of
remission (return to a lower level of albumin excretion, an
indication of kidney recovery) influences mortality.
<em>Remission</em> is a time-dependent variable which is initially 0, but
takes the value 1 when remission occurs. In order to handle this, each
person who sees a remission must have two records:</p>
<ul>
<li>One record for the time before remission, where entry is
<code>doe</code>, exit is <code>dor</code>, remission is 0, and event is 0.</li>
<li>One record for the time after remission, where entry is
<code>dor</code>, exit is <code>dox</code>, remission is 1, and event is 0
or 1 according to whether the person had an event at <code>dox</code>.</li>
</ul>
<p>This is accomplished using the <code>cutLexis</code> function on the
<code>Lexis</code> object, where we introduce a remission state <code>Rem</code>.
Also use <code>split.state=TRUE</code> to
have different ESRD states according to whether a person had had
remission or not prioer to ESRD. The statement to do this is:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb748-1"><a href="time-dependent-variables-and-multiple-states.html#cb748-1" tabindex="-1"></a>Lc <span class="ot">&lt;-</span> <span class="fu">cutLexis</span>(Lr, <span class="at">cut =</span> Lr<span class="sc">$</span>dor, <span class="co"># where to cut follow up</span></span>
<span id="cb748-2"><a href="time-dependent-variables-and-multiple-states.html#cb748-2" tabindex="-1"></a>             <span class="at">timescale =</span> <span class="st">&quot;per&quot;</span>,  <span class="co"># what timescale are we referring to</span></span>
<span id="cb748-3"><a href="time-dependent-variables-and-multiple-states.html#cb748-3" tabindex="-1"></a>             <span class="at">new.state =</span> <span class="st">&quot;Rem&quot;</span>,  <span class="co"># name of the new state</span></span>
<span id="cb748-4"><a href="time-dependent-variables-and-multiple-states.html#cb748-4" tabindex="-1"></a>           <span class="at">split.state =</span> <span class="cn">TRUE</span>)   <span class="co"># different states depending on previous</span></span>
<span id="cb748-5"><a href="time-dependent-variables-and-multiple-states.html#cb748-5" tabindex="-1"></a><span class="fu">summary</span>(Lc)</span></code></pre></div>
<pre><code>
Transitions:
     To
From  NRA Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA  24  29   69         0       122       98     824.77       122
  Rem   0  24    0         8        32        8     259.90        32
  Sum  24  53   69         8       154      106    1084.67       125</code></pre>
<p>List the records from a few select persons (choose values for
<code>lex.id</code>, using for example <code>subset(Lc, lex.id %in% c(5,7,9))</code>).</p></li>
<li><p>Now show how the states are connected and the number of transitions
between them by using <code>boxes</code>. This is an interactive command
that requires you to click in the graph window:</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb750-1"><a href="time-dependent-variables-and-multiple-states.html#cb750-1" tabindex="-1"></a><span class="fu">boxes</span>(Lc)</span></code></pre></div>
<p>It has a couple of fancy arguments, try:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb751-1"><a href="time-dependent-variables-and-multiple-states.html#cb751-1" tabindex="-1"></a><span class="fu">boxes</span>(Lc, <span class="at">boxpos =</span> <span class="cn">TRUE</span>, <span class="at">scale.R =</span> <span class="dv">100</span>, <span class="at">show.BE =</span> <span class="cn">TRUE</span>, <span class="at">hm =</span> <span class="fl">1.5</span>, <span class="at">wm =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/Lc-boxes-1.png" width="672" /></p>
<p>You may even be tempted to read the help page for
<code>boxes.Lexis</code> …</p></li>
<li><p>Plot a Lexis diagram where different coloring is
used for different segments of the follow-up. The
<code>plot.Lexis</code> function draws a line for each record in the
dataset, so you can index the coloring by <code>lex.Cst</code> and
<code>lex.Xst</code> as appropriate — indexing by a factor corresponds
to indexing by the <em>index number</em> of the factor levels, so you
must be know which order the factor levels are in:</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb752-1"><a href="time-dependent-variables-and-multiple-states.html#cb752-1" tabindex="-1"></a><span class="fu">levels</span>(Lc) <span class="co"># names and order of states in lex.Cst and lex.Xst</span></span></code></pre></div>
<pre><code>[1] &quot;NRA&quot;       &quot;Rem&quot;       &quot;ESRD&quot;      &quot;ESRD(Rem)&quot;</code></pre>
<div class="sourceCode" id="cb754"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb754-1"><a href="time-dependent-variables-and-multiple-states.html#cb754-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mai =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">4</span>, <span class="at">mgp =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="sc">/</span> <span class="fl">1.6</span>)</span>
<span id="cb754-2"><a href="time-dependent-variables-and-multiple-states.html#cb754-2" tabindex="-1"></a><span class="fu">plot</span>(Lc, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;limegreen&quot;</span>)[Lc<span class="sc">$</span>lex.Cst],</span>
<span id="cb754-3"><a href="time-dependent-variables-and-multiple-states.html#cb754-3" tabindex="-1"></a>        <span class="at">xlab =</span> <span class="st">&quot;Calendar time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Age&quot;</span>,</span>
<span id="cb754-4"><a href="time-dependent-variables-and-multiple-states.html#cb754-4" tabindex="-1"></a>         <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">grid =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span> <span class="sc">*</span> <span class="dv">5</span>, <span class="at">las =</span> <span class="dv">1</span>,</span>
<span id="cb754-5"><a href="time-dependent-variables-and-multiple-states.html#cb754-5" tabindex="-1"></a>        <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1970</span>, <span class="dv">2010</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">70</span>), </span>
<span id="cb754-6"><a href="time-dependent-variables-and-multiple-states.html#cb754-6" tabindex="-1"></a>        <span class="at">xaxs =</span> <span class="st">&quot;i&quot;</span>, <span class="at">yaxs =</span> <span class="st">&quot;i&quot;</span>)</span>
<span id="cb754-7"><a href="time-dependent-variables-and-multiple-states.html#cb754-7" tabindex="-1"></a><span class="fu">points</span>(Lc, <span class="at">pch =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">16</span>, <span class="dv">16</span>)[Lc<span class="sc">$</span>lex.Xst],</span>
<span id="cb754-8"><a href="time-dependent-variables-and-multiple-states.html#cb754-8" tabindex="-1"></a>           <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;limegreen&quot;</span>, <span class="st">&quot;transparent&quot;</span>, <span class="st">&quot;transparent&quot;</span>)[Lc<span class="sc">$</span>lex.Cst])</span>
<span id="cb754-9"><a href="time-dependent-variables-and-multiple-states.html#cb754-9" tabindex="-1"></a><span class="fu">points</span>(Lc, <span class="at">pch =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">1</span>)[Lc<span class="sc">$</span>lex.Xst],</span>
<span id="cb754-10"><a href="time-dependent-variables-and-multiple-states.html#cb754-10" tabindex="-1"></a>           <span class="at">col =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/Lexis-rem-1.png" width="672" /></p></li>
<li><p>Make a Cox-regression of mortality rates (i.e. endpoint <code>ESRD</code> or
<code>ESRD(Rem)</code>) with sex, age at entry and remission as
explanatory variables, using time since entry as timescale, and
include <code>lex.Cst</code> as time-dependent variable, and
indicate that each record represents follow-up from
<code>tfi</code> to <code>tfi+lex.dur</code>. Make sure that you know
why what goes where here in the call to <code>coxph</code>.</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb755-1"><a href="time-dependent-variables-and-multiple-states.html#cb755-1" tabindex="-1"></a>(EP <span class="ot">&lt;-</span> <span class="fu">levels</span>(Lc)[<span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>])           <span class="co"># define EndPoint states</span></span></code></pre></div>
<pre><code>[1] &quot;ESRD&quot;      &quot;ESRD(Rem)&quot;</code></pre>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb757-1"><a href="time-dependent-variables-and-multiple-states.html#cb757-1" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(tfi,             <span class="co"># entry time</span></span>
<span id="cb757-2"><a href="time-dependent-variables-and-multiple-states.html#cb757-2" tabindex="-1"></a>                 tfi <span class="sc">+</span> lex.dur,   <span class="co"># exit time</span></span>
<span id="cb757-3"><a href="time-dependent-variables-and-multiple-states.html#cb757-3" tabindex="-1"></a>                 lex.Xst <span class="sc">%in%</span> EP) <span class="co"># event</span></span>
<span id="cb757-4"><a href="time-dependent-variables-and-multiple-states.html#cb757-4" tabindex="-1"></a>            <span class="sc">~</span> sex <span class="sc">+</span> <span class="fu">I</span>((doe <span class="sc">-</span> dob <span class="sc">-</span> <span class="dv">50</span>) <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">+</span> <span class="co"># fixed covariates</span></span>
<span id="cb757-5"><a href="time-dependent-variables-and-multiple-states.html#cb757-5" tabindex="-1"></a>              (lex.Cst <span class="sc">==</span> <span class="st">&quot;Rem&quot;</span>),              <span class="co"># time-dependent variable</span></span>
<span id="cb757-6"><a href="time-dependent-variables-and-multiple-states.html#cb757-6" tabindex="-1"></a>            <span class="at">data =</span> Lc)</span>
<span id="cb757-7"><a href="time-dependent-variables-and-multiple-states.html#cb757-7" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code></pre></div>
<pre><code>Call:
coxph(formula = Surv(tfi, tfi + lex.dur, lex.Xst %in% EP) ~ sex + 
    I((doe - dob - 50)/10) + (lex.Cst == &quot;Rem&quot;), data = Lc)

  n= 154, number of events= 77 

                           coef exp(coef) se(coef)      z Pr(&gt;|z|)
sexF                   -0.05534   0.94616  0.27500 -0.201 0.840517
I((doe - dob - 50)/10)  0.52190   1.68522  0.13655  3.822 0.000132
lex.Cst == &quot;Rem&quot;TRUE   -1.26241   0.28297  0.38483 -3.280 0.001036

                       exp(coef) exp(-coef) lower .95 upper .95
sexF                      0.9462     1.0569    0.5519    1.6220
I((doe - dob - 50)/10)    1.6852     0.5934    1.2895    2.2024
lex.Cst == &quot;Rem&quot;TRUE      0.2830     3.5339    0.1331    0.6016

Concordance= 0.664  (se = 0.033 )
Likelihood ratio test= 30.31  on 3 df,   p=1e-06
Wald test            = 27.07  on 3 df,   p=6e-06
Score (logrank) test = 29.41  on 3 df,   p=2e-06</code></pre>
<p>What is the effect of of remission on the rate of ESRD?</p>
<h2 id="splitting-the-follow-up-time" class="hasAnchor">Splitting the follow-up time<a href="time-dependent-variables-and-multiple-states.html#splitting-the-follow-up-time" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In order to explore the effect of remission on the rate of ESRD, we
split the data further into small pieces of follow-up. To this
end we use the function <code>splitLexis</code>. The rates can then be
modeled using a Poisson-model, and the shape of the effect of the
underlying <em>rates</em> be explored. Furthermore, we can allow effects of both
time since NRA and current age. To this end we will use splines, so we
need the <code>splines</code> and also the <code>mgcv</code> packages.</p></li>
<li><p>Now split the follow-up time every month after entry, and verify
that the number of events and risk time is the same as before and
after the split:</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb759-1"><a href="time-dependent-variables-and-multiple-states.html#cb759-1" tabindex="-1"></a>sLc <span class="ot">&lt;-</span> <span class="fu">splitLexis</span>(Lc, <span class="st">&quot;tfi&quot;</span>, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">30</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">12</span>))</span>
<span id="cb759-2"><a href="time-dependent-variables-and-multiple-states.html#cb759-2" tabindex="-1"></a><span class="fu">summary</span>( Lc)</span></code></pre></div>
<pre><code>
Transitions:
     To
From  NRA Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA  24  29   69         0       122       98     824.77       122
  Rem   0  24    0         8        32        8     259.90        32
  Sum  24  53   69         8       154      106    1084.67       125</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb761-1"><a href="time-dependent-variables-and-multiple-states.html#cb761-1" tabindex="-1"></a><span class="fu">summary</span>(sLc)</span></code></pre></div>
<pre><code>
Transitions:
     To
From   NRA  Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA 9854   29   69         0      9952       98     824.77       122
  Rem    0 3139    0         8      3147        8     259.90        32
  Sum 9854 3168   69         8     13099      106    1084.67       125</code></pre></li>
<li><p>Now fit the Poisson-model corresponding to the Cox-model
we fitted previously. The function <code>Ns()</code> produces a model
matrix corresponding to a piece-wise cubic function, modeling the
baseline hazard explicitly (think of the <code>Ns</code> terms as the
baseline hazard that is not visible in the Cox-model). You
can use the wrapper function <code>glm.Lexis</code></p>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb763-1"><a href="time-dependent-variables-and-multiple-states.html#cb763-1" tabindex="-1"></a>mp <span class="ot">&lt;-</span> <span class="fu">glm.Lexis</span>(sLc, </span>
<span id="cb763-2"><a href="time-dependent-variables-and-multiple-states.html#cb763-2" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">Ns</span>(tfi, <span class="at">knots =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb763-3"><a href="time-dependent-variables-and-multiple-states.html#cb763-3" tabindex="-1"></a>                  sex <span class="sc">+</span> <span class="fu">I</span>((doe <span class="sc">-</span> dob <span class="sc">-</span> <span class="dv">40</span>) <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb763-4"><a href="time-dependent-variables-and-multiple-states.html#cb763-4" tabindex="-1"></a>                  <span class="fu">I</span>(lex.Cst <span class="sc">==</span> <span class="st">&quot;Rem&quot;</span>))</span></code></pre></div>
<pre><code>stats::glm Poisson analysis of Lexis object sLc with log link:
Rates for transitions:
NRA-&gt;ESRD
Rem-&gt;ESRD(Rem)</code></pre>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb765-1"><a href="time-dependent-variables-and-multiple-states.html#cb765-1" tabindex="-1"></a><span class="fu">ci.exp</span>(mp)</span></code></pre></div>
<pre><code>                                   exp(Est.)        2.5%        97.5%
(Intercept)                       0.01664432 0.003956666   0.07001685
Ns(tfi, knots = c(0, 2, 5, 10))1  5.18917655 1.949197027  13.81469029
Ns(tfi, knots = c(0, 2, 5, 10))2 34.20004199 1.764818735 662.75524463
Ns(tfi, knots = c(0, 2, 5, 10))3  4.43318269 2.179977108   9.01528219
sexF                              0.91751162 0.536258443   1.56981691
I((doe - dob - 40)/10)            1.70082390 1.300813859   2.22384004
I(lex.Cst == &quot;Rem&quot;)TRUE           0.27927558 0.131396852   0.59358233</code></pre>
<p>How does the effects of sex change from the Cox-model?</p></li>
<li><p>Try instead using the <code>gam</code> function from the
<code>mgcv</code> package. There is convenience wrapper for this for
<code>Lexis</code> objects as well:</p>
<div class="sourceCode" id="cb767"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb767-1"><a href="time-dependent-variables-and-multiple-states.html#cb767-1" tabindex="-1"></a>mx <span class="ot">&lt;-</span> <span class="fu">gam.Lexis</span>(sLc,</span>
<span id="cb767-2"><a href="time-dependent-variables-and-multiple-states.html#cb767-2" tabindex="-1"></a>                <span class="sc">~</span> <span class="fu">s</span>(tfi, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb767-3"><a href="time-dependent-variables-and-multiple-states.html#cb767-3" tabindex="-1"></a>                  sex <span class="sc">+</span> <span class="fu">I</span>((doe <span class="sc">-</span> dob <span class="sc">-</span> <span class="dv">40</span>) <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">+</span> </span>
<span id="cb767-4"><a href="time-dependent-variables-and-multiple-states.html#cb767-4" tabindex="-1"></a>                  <span class="fu">I</span>(lex.Cst <span class="sc">==</span> <span class="st">&quot;Rem&quot;</span>))</span></code></pre></div>
<pre><code>mgcv::gam Poisson analysis of Lexis object sLc with log link:
Rates for transitions:
NRA-&gt;ESRD
Rem-&gt;ESRD(Rem)</code></pre>
<div class="sourceCode" id="cb769"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb769-1"><a href="time-dependent-variables-and-multiple-states.html#cb769-1" tabindex="-1"></a><span class="fu">ci.exp</span>(mp, <span class="at">subset =</span> <span class="fu">c</span>(<span class="st">&quot;Cst&quot;</span>, <span class="st">&quot;doe&quot;</span>, <span class="st">&quot;sex&quot;</span>))</span></code></pre></div>
<pre><code>                        exp(Est.)      2.5%     97.5%
I(lex.Cst == &quot;Rem&quot;)TRUE 0.2792756 0.1313969 0.5935823
I((doe - dob - 40)/10)  1.7008239 1.3008139 2.2238400
sexF                    0.9175116 0.5362584 1.5698169</code></pre>
<div class="sourceCode" id="cb771"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb771-1"><a href="time-dependent-variables-and-multiple-states.html#cb771-1" tabindex="-1"></a><span class="fu">ci.exp</span>(mx, <span class="at">subset =</span> <span class="fu">c</span>(<span class="st">&quot;Cst&quot;</span>, <span class="st">&quot;doe&quot;</span>, <span class="st">&quot;sex&quot;</span>))</span></code></pre></div>
<pre><code>                        exp(Est.)      2.5%     97.5%
I(lex.Cst == &quot;Rem&quot;)TRUE 0.2784659 0.1309446 0.5921838
I((doe - dob - 40)/10)  1.6992069 1.2995225 2.2218192
sexF                    0.9309945 0.5435486 1.5946150</code></pre>
<p>We see that there is virtually no difference between the two
approaches in terms of the regression parameters.</p></li>
<li><p>Extract the regression parameters from the models using
<code>ci.exp</code> and compare with the estimates from the Cox-model:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb773-1"><a href="time-dependent-variables-and-multiple-states.html#cb773-1" tabindex="-1"></a><span class="fu">ci.exp</span>(mx, <span class="at">subset =</span> <span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;dob&quot;</span>, <span class="st">&quot;Cst&quot;</span>), <span class="at">pval =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>                        exp(Est.)      2.5%     97.5%            P
sexF                    0.9309945 0.5435486 1.5946150 0.7945394004
I((doe - dob - 40)/10)  1.6992069 1.2995225 2.2218192 0.0001066910
I(lex.Cst == &quot;Rem&quot;)TRUE 0.2784659 0.1309446 0.5921838 0.0008970863</code></pre>
<div class="sourceCode" id="cb775"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb775-1"><a href="time-dependent-variables-and-multiple-states.html#cb775-1" tabindex="-1"></a><span class="fu">ci.exp</span>(m1)</span></code></pre></div>
<pre><code>                       exp(Est.)      2.5%    97.5%
sexF                   0.9461646 0.5519334 1.621985
I((doe - dob - 50)/10) 1.6852196 1.2895097 2.202360
lex.Cst == &quot;Rem&quot;TRUE   0.2829710 0.1330996 0.601599</code></pre>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb777-1"><a href="time-dependent-variables-and-multiple-states.html#cb777-1" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">ci.exp</span>(mp, <span class="at">subset =</span> <span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;dob&quot;</span>, <span class="st">&quot;Cst&quot;</span>)) <span class="sc">/</span> <span class="fu">ci.exp</span>(m1), <span class="dv">2</span>)</span></code></pre></div>
<pre><code>                        exp(Est.) 2.5% 97.5%
sexF                         0.97 0.97  0.97
I((doe - dob - 40)/10)       1.01 1.01  1.01
I(lex.Cst == &quot;Rem&quot;)TRUE      0.99 0.99  0.99</code></pre>
<p>How large are the differences in estimated regression parameters?</p></li>
<li><p>The model has the same assumptions as the Cox-model about
proportionality of rates, but there is an additional assumption that
the hazard is a smooth function of time since entry. It seems to be
a sensible assumption (well, restriction) to put on the rates that
they vary smoothly by time. No such restriction is made in the Cox
model. The <code>gam</code> model optimizes the shape of the smoother by
general cross-validation. Try to look at the shape of the
estimated effect of <code>tfi</code>:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb779-1"><a href="time-dependent-variables-and-multiple-states.html#cb779-1" tabindex="-1"></a><span class="fu">plot</span>(mx)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Is this a useful plot?</p></li>
<li><p>However, <code>plot</code> (well, <code>plot.gam</code>) does not give you the <em>absolute</em>
level of the underlying rates because it bypasses the intercept. So
in order to predict the rates as a function of <code>tfi</code> and the
covariates, we set up a prediction data frame. Note that age
in the model specification is entered as <code>doe-dob</code>, hence
the prediction data frame must have these two variables and not
the age, but it is only the difference that matters for the prediction:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb780-1"><a href="time-dependent-variables-and-multiple-states.html#cb780-1" tabindex="-1"></a>nd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">tfi =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="fl">0.1</span>),</span>
<span id="cb780-2"><a href="time-dependent-variables-and-multiple-states.html#cb780-2" tabindex="-1"></a>                 <span class="at">sex =</span> <span class="st">&quot;M&quot;</span>,</span>
<span id="cb780-3"><a href="time-dependent-variables-and-multiple-states.html#cb780-3" tabindex="-1"></a>                 <span class="at">doe =</span> <span class="dv">1990</span>,</span>
<span id="cb780-4"><a href="time-dependent-variables-and-multiple-states.html#cb780-4" tabindex="-1"></a>                 <span class="at">dob =</span> <span class="dv">1940</span>,</span>
<span id="cb780-5"><a href="time-dependent-variables-and-multiple-states.html#cb780-5" tabindex="-1"></a>             <span class="at">lex.Cst =</span> <span class="st">&quot;NRA&quot;</span>)</span>
<span id="cb780-6"><a href="time-dependent-variables-and-multiple-states.html#cb780-6" tabindex="-1"></a><span class="fu">str</span>(nd)</span></code></pre></div>
<pre><code>&#39;data.frame&#39;:   201 obs. of  5 variables:
 $ tfi    : num  0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 ...
 $ sex    : chr  &quot;M&quot; &quot;M&quot; &quot;M&quot; &quot;M&quot; ...
 $ doe    : num  1990 1990 1990 1990 1990 1990 1990 1990 1990 1990 ...
 $ dob    : num  1940 1940 1940 1940 1940 1940 1940 1940 1940 1940 ...
 $ lex.Cst: chr  &quot;NRA&quot; &quot;NRA&quot; &quot;NRA&quot; &quot;NRA&quot; ...</code></pre>
<div class="sourceCode" id="cb782"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb782-1"><a href="time-dependent-variables-and-multiple-states.html#cb782-1" tabindex="-1"></a><span class="fu">matshade</span>(nd<span class="sc">$</span>tfi, <span class="fu">cbind</span>(<span class="fu">ci.pred</span>(mp, <span class="at">newdata =</span> nd),</span>
<span id="cb782-2"><a href="time-dependent-variables-and-multiple-states.html#cb782-2" tabindex="-1"></a>                       <span class="fu">ci.pred</span>(mx, <span class="at">newdata =</span> nd)) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb782-3"><a href="time-dependent-variables-and-multiple-states.html#cb782-3" tabindex="-1"></a>         <span class="at">plot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb782-4"><a href="time-dependent-variables-and-multiple-states.html#cb782-4" tabindex="-1"></a>         <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>),</span>
<span id="cb782-5"><a href="time-dependent-variables-and-multiple-states.html#cb782-5" tabindex="-1"></a>         <span class="at">log =</span> <span class="st">&quot;y&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Time since entry (years)&quot;</span>,</span>
<span id="cb782-6"><a href="time-dependent-variables-and-multiple-states.html#cb782-6" tabindex="-1"></a>         <span class="at">ylab =</span> <span class="st">&quot;ESRD rate (per 100 PY) for 50 year old men&quot;</span>)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/pred-1.png" width="672" />
Try to overlay with the corresponding prediction from the
<code>glm</code> model using <code>Ns</code>.</p></li>
</ol>
<p>## Prediction from the multistate model</p>
<pre><code>If we want to make proper statements about the survival and disease
probabilities we must know not only how the occurrence of remission
influences the rate of death/ESRD, but we must also model the
occurrence rate of remission itself.</code></pre>
<ol start="17" style="list-style-type: decimal">
<li><p>The rates of ESRD were modelled by a Poisson model with
effects of age and time since NRA — in the models <code>mp</code>
and <code>mx</code>. But if we want to model whole process we must
also model the remission rates transition from <code>NRA</code> to
<code>Rem</code>, but the number of events is rather small so we restrict
covariates in this model to only time since NRA and sex. Note
that only the records that represent follow-up in the <code>NRA</code>
state should be used; this is most easily done using the
<code>gam.Lexis</code> function</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb784-1"><a href="time-dependent-variables-and-multiple-states.html#cb784-1" tabindex="-1"></a>mr <span class="ot">&lt;-</span> <span class="fu">gam.Lexis</span>(sLc, <span class="sc">~</span> <span class="fu">s</span>(tfi, <span class="at">k =</span> <span class="dv">10</span>) <span class="sc">+</span> sex,</span>
<span id="cb784-2"><a href="time-dependent-variables-and-multiple-states.html#cb784-2" tabindex="-1"></a>                     <span class="at">from =</span> <span class="st">&quot;NRA&quot;</span>,</span>
<span id="cb784-3"><a href="time-dependent-variables-and-multiple-states.html#cb784-3" tabindex="-1"></a>                       <span class="at">to =</span> <span class="st">&quot;Rem&quot;</span>)</span></code></pre></div>
<pre><code>mgcv::gam Poisson analysis of Lexis object sLc with log link:
Rates for the transition:
NRA-&gt;Rem</code></pre>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb786-1"><a href="time-dependent-variables-and-multiple-states.html#cb786-1" tabindex="-1"></a><span class="fu">summary</span>(mr)</span></code></pre></div>
<pre><code>
Family: poisson 
Link function: log 

Formula:
cbind(trt(Lx$lex.Cst, Lx$lex.Xst) %in% trnam, Lx$lex.dur) ~ s(tfi, 
    k = 10) + sex

Parametric coefficients:
            Estimate Std. Error z value Pr(&gt;|z|)
(Intercept)  -3.7025     0.2582 -14.339   &lt;2e-16
sexF          0.9579     0.3728   2.569   0.0102

Approximate significance of smooth terms:
         edf Ref.df Chi.sq p-value
s(tfi) 1.013  1.025  0.066   0.813

R-sq.(adj) =  -5.65e-06   Deviance explained = 1.65%
UBRE = -0.96024  Scale est. = 1         n = 9952</code></pre>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb788-1"><a href="time-dependent-variables-and-multiple-states.html#cb788-1" tabindex="-1"></a><span class="fu">ci.exp</span>(mr, <span class="at">pval =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>             exp(Est.)       2.5%      97.5%            P
(Intercept) 0.02466174 0.01486718 0.04090901 1.254019e-46
sexF        2.60620470 1.25503844 5.41202779 1.019130e-02
s(tfi).1    1.00499489 0.89131271 1.13317662 9.351638e-01
s(tfi).2    0.99623769 0.80778743 1.22865188 9.718940e-01
s(tfi).3    0.99822247 0.91911268 1.08414140 9.663137e-01
s(tfi).4    1.00188999 0.89006998 1.12775801 9.750528e-01
s(tfi).5    0.99842904 0.92280785 1.08024715 9.687920e-01
s(tfi).6    0.99817367 0.90142303 1.10530865 9.719666e-01
s(tfi).7    1.00168704 0.92615949 1.08337380 9.663850e-01
s(tfi).8    0.99448155 0.68445450 1.44493689 9.768400e-01
s(tfi).9    0.94790052 0.63349476 1.41834700 7.946918e-01</code></pre>
<p>What is the remission rate-ratio between men and women?</p></li>
<li><p>If we want to predict the probability of being in each of the
three states using these estimated rates, we may resort to
analytical calculations of the probabilities from the estimated
rates, which is actually doable in this case, but which will be largely
intractable for more complicated models.
Alternatively we can <em>simulate</em> the life course for a large
group of (identical) individuals through a model using the estimated
rates. That will give a simulated cohort (in the form of a
<code>Lexis</code> object), and we can then just count the number of
persons in each state at each of a set of time points.
This is accomplished using the function <code>simLexis</code>. The input
to this is the initial status of the persons whose life-course we
shall simulate, and the transition rates in suitable form:</p>
<ul>
<li>Suppose we want predictions for men aged 50 at
NRA. The input is in the form of a <code>Lexis</code> object (where
<code>lex.dur</code> and <code>lex.Xst</code> will be ignored). Note that in
order to carry over the <code>time.scales</code> and the
<code>time.since</code> attributes, we construct the input object using
<code>subset</code> to select columns, and <code>NULL</code> to select rows
(see the example in the help file for <code>simLexis</code>):</li>
</ul>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb790-1"><a href="time-dependent-variables-and-multiple-states.html#cb790-1" tabindex="-1"></a>inL <span class="ot">&lt;-</span> <span class="fu">subset</span>(sLc, <span class="at">select =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)[<span class="cn">NULL</span>, ]</span>
<span id="cb790-2"><a href="time-dependent-variables-and-multiple-states.html#cb790-2" tabindex="-1"></a><span class="fu">str</span>(inL)</span></code></pre></div>
<pre><code>Classes &#39;Lexis&#39; and &#39;data.frame&#39;:   0 obs. of  11 variables:
 $ lex.id : int 
 $ per    : num 
 $ age    : num 
 $ tfi    : num 
 $ lex.dur: num 
 $ lex.Cst: Factor w/ 4 levels &quot;NRA&quot;,&quot;Rem&quot;,&quot;ESRD&quot;,..: 
 $ lex.Xst: Factor w/ 4 levels &quot;NRA&quot;,&quot;Rem&quot;,&quot;ESRD&quot;,..: 
 $ id     : num 
 $ sex    : Factor w/ 2 levels &quot;M&quot;,&quot;F&quot;: 
 $ dob    : num 
 $ doe    : num 
 - attr(*, &quot;time.scales&quot;)= chr [1:3] &quot;per&quot; &quot;age&quot; &quot;tfi&quot;
 - attr(*, &quot;time.since&quot;)= chr [1:3] &quot;&quot; &quot;&quot; &quot;&quot;
 - attr(*, &quot;breaks&quot;)=List of 3
  ..$ per: NULL
  ..$ age: NULL
  ..$ tfi: num [1:361] 0 0.0833 0.1667 0.25 0.3333 ...</code></pre>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb792-1"><a href="time-dependent-variables-and-multiple-states.html#cb792-1" tabindex="-1"></a><span class="fu">timeScales</span>(inL)</span></code></pre></div>
<pre><code>[1] &quot;per&quot; &quot;age&quot; &quot;tfi&quot;</code></pre>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb794-1"><a href="time-dependent-variables-and-multiple-states.html#cb794-1" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;lex.id&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb794-2"><a href="time-dependent-variables-and-multiple-states.html#cb794-2" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;per&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb794-3"><a href="time-dependent-variables-and-multiple-states.html#cb794-3" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;age&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb794-4"><a href="time-dependent-variables-and-multiple-states.html#cb794-4" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;tfi&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb794-5"><a href="time-dependent-variables-and-multiple-states.html#cb794-5" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;lex.Cst&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;NRA&quot;</span></span>
<span id="cb794-6"><a href="time-dependent-variables-and-multiple-states.html#cb794-6" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;lex.Xst&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb794-7"><a href="time-dependent-variables-and-multiple-states.html#cb794-7" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;lex.dur&quot;</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb794-8"><a href="time-dependent-variables-and-multiple-states.html#cb794-8" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;sex&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;M&quot;</span></span>
<span id="cb794-9"><a href="time-dependent-variables-and-multiple-states.html#cb794-9" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;doe&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">2000</span></span>
<span id="cb794-10"><a href="time-dependent-variables-and-multiple-states.html#cb794-10" tabindex="-1"></a>inL[<span class="dv">1</span>, <span class="st">&quot;dob&quot;</span>] <span class="ot">&lt;-</span> <span class="dv">1950</span></span>
<span id="cb794-11"><a href="time-dependent-variables-and-multiple-states.html#cb794-11" tabindex="-1"></a>inL <span class="ot">&lt;-</span> <span class="fu">rbind</span>(inL, inL)</span>
<span id="cb794-12"><a href="time-dependent-variables-and-multiple-states.html#cb794-12" tabindex="-1"></a>inL[<span class="dv">2</span>, <span class="st">&quot;sex&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;F&quot;</span></span>
<span id="cb794-13"><a href="time-dependent-variables-and-multiple-states.html#cb794-13" tabindex="-1"></a>inL</span></code></pre></div>
<pre><code> lex.id  per age tfi lex.dur lex.Cst lex.Xst id sex  dob  doe
      1 2000  50   0      NA     NRA    &lt;NA&gt; NA   M 1950 2000
      1 2000  50   0      NA     NRA    &lt;NA&gt; NA   F 1950 2000</code></pre>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb796-1"><a href="time-dependent-variables-and-multiple-states.html#cb796-1" tabindex="-1"></a><span class="fu">str</span>(inL)</span></code></pre></div>
<pre><code>Classes &#39;Lexis&#39; and &#39;data.frame&#39;:   2 obs. of  11 variables:
 $ lex.id : num  1 1
 $ per    : num  2000 2000
 $ age    : num  50 50
 $ tfi    : num  0 0
 $ lex.dur: num  NA NA
 $ lex.Cst: Factor w/ 4 levels &quot;NRA&quot;,&quot;Rem&quot;,&quot;ESRD&quot;,..: 1 1
 $ lex.Xst: Factor w/ 4 levels &quot;NRA&quot;,&quot;Rem&quot;,&quot;ESRD&quot;,..: NA NA
 $ id     : num  NA NA
 $ sex    : Factor w/ 2 levels &quot;M&quot;,&quot;F&quot;: 1 2
 $ dob    : num  1950 1950
 $ doe    : num  2000 2000
 - attr(*, &quot;breaks&quot;)=List of 3
  ..$ per: NULL
  ..$ age: NULL
  ..$ tfi: num [1:361] 0 0.0833 0.1667 0.25 0.3333 ...
 - attr(*, &quot;time.scales&quot;)= chr [1:3] &quot;per&quot; &quot;age&quot; &quot;tfi&quot;
 - attr(*, &quot;time.since&quot;)= chr [1:3] &quot;&quot; &quot;&quot; &quot;&quot;</code></pre>
<p>The other input for the simulation is the models for the transitions. This is given as
a list with an element for each transient state (that is <code>NRA</code> and
<code>Rem</code>), each of which is again a list with names equal to the
states that can be reached from the transient state. The content of
the list will be <code>glm</code> objects, in this case the models we
just fitted, describing the transition rates:</p>
<div class="sourceCode" id="cb798"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb798-1"><a href="time-dependent-variables-and-multiple-states.html#cb798-1" tabindex="-1"></a>Tr <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;NRA&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;Rem&quot;</span>  <span class="ot">=</span> mr,</span>
<span id="cb798-2"><a href="time-dependent-variables-and-multiple-states.html#cb798-2" tabindex="-1"></a>                        <span class="st">&quot;ESRD&quot;</span> <span class="ot">=</span> mx),</span>
<span id="cb798-3"><a href="time-dependent-variables-and-multiple-states.html#cb798-3" tabindex="-1"></a>           <span class="st">&quot;Rem&quot;</span> <span class="ot">=</span> <span class="fu">list</span>(<span class="st">&quot;ESRD(Rem)&quot;</span> <span class="ot">=</span> mx))</span></code></pre></div>
<p>With this as input we can now generate a cohort, using <code>N=5</code>
to simulate life course of 10 persons (5 for each set of starting values
in <code>inL</code>):</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb799-1"><a href="time-dependent-variables-and-multiple-states.html#cb799-1" tabindex="-1"></a>(iL <span class="ot">&lt;-</span> <span class="fu">simLexis</span>(Tr, inL, <span class="at">N =</span> <span class="dv">10</span>))</span></code></pre></div>
<pre><code> lex.id     per   age  tfi lex.dur lex.Cst   lex.Xst id sex  dob  doe cens
      1 2000.00 50.00 0.00    6.17     NRA      ESRD NA   M 1950 2000 2020
      2 2000.00 50.00 0.00    5.42     NRA      ESRD NA   M 1950 2000 2020
      3 2000.00 50.00 0.00    5.48     NRA      ESRD NA   M 1950 2000 2020
      4 2000.00 50.00 0.00    4.47     NRA      ESRD NA   M 1950 2000 2020
      5 2000.00 50.00 0.00    7.70     NRA      ESRD NA   M 1950 2000 2020
      6 2000.00 50.00 0.00    5.33     NRA      ESRD NA   M 1950 2000 2020
      7 2000.00 50.00 0.00    5.90     NRA      ESRD NA   M 1950 2000 2020
      8 2000.00 50.00 0.00    4.43     NRA      ESRD NA   M 1950 2000 2020
      9 2000.00 50.00 0.00    2.55     NRA      ESRD NA   M 1950 2000 2020
     10 2000.00 50.00 0.00    2.88     NRA       Rem NA   M 1950 2000 2020
     10 2002.88 52.88 2.88   17.12     Rem       Rem NA   M 1950 2000 2020
     11 2000.00 50.00 0.00    0.73     NRA      ESRD NA   F 1950 2000 2020
     12 2000.00 50.00 0.00    5.53     NRA       Rem NA   F 1950 2000 2020
     12 2005.53 55.53 5.53   14.18     Rem ESRD(Rem) NA   F 1950 2000 2020
     13 2000.00 50.00 0.00    0.95     NRA       Rem NA   F 1950 2000 2020
     13 2000.95 50.95 0.95    6.42     Rem ESRD(Rem) NA   F 1950 2000 2020
     14 2000.00 50.00 0.00    8.84     NRA       Rem NA   F 1950 2000 2020
     14 2008.84 58.84 8.84    7.64     Rem ESRD(Rem) NA   F 1950 2000 2020
     15 2000.00 50.00 0.00    1.86     NRA      ESRD NA   F 1950 2000 2020
     16 2000.00 50.00 0.00    2.12     NRA       Rem NA   F 1950 2000 2020
     16 2002.12 52.12 2.12    6.76     Rem ESRD(Rem) NA   F 1950 2000 2020
     17 2000.00 50.00 0.00    1.29     NRA       Rem NA   F 1950 2000 2020
     17 2001.29 51.29 1.29   18.71     Rem       Rem NA   F 1950 2000 2020
     18 2000.00 50.00 0.00    5.35     NRA      ESRD NA   F 1950 2000 2020
     19 2000.00 50.00 0.00    1.62     NRA      ESRD NA   F 1950 2000 2020
     20 2000.00 50.00 0.00    5.71     NRA       Rem NA   F 1950 2000 2020
     20 2005.71 55.71 5.71    3.48     Rem ESRD(Rem) NA   F 1950 2000 2020</code></pre>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb801-1"><a href="time-dependent-variables-and-multiple-states.html#cb801-1" tabindex="-1"></a><span class="fu">summary</span>(iL, <span class="at">by =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<pre><code>$M

Transitions:
     To
From  NRA Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA   0   1    9         0        10       10      50.33        10
  Rem   0   1    0         0         1        0      17.12         1
  Sum   0   2    9         0        11       10      67.45        10

$F

Transitions:
     To
From  NRA Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA   0   6    4         0        10       10       34.0        10
  Rem   0   1    0         5         6        5       57.2         6
  Sum   0   7    4         5        16       15       91.2        10</code></pre>
<p>What type of object have you got as <code>iL</code>?</p></li>
<li><p>Now generate the life course of, say, 5,000 persons, and look at the summary.
The <code>system.time</code> command is just to tell you how long it
took, you may want to start with 500 just to see how long that takes.</p>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb803-1"><a href="time-dependent-variables-and-multiple-states.html#cb803-1" tabindex="-1"></a><span class="fu">system.time</span>(sM <span class="ot">&lt;-</span> <span class="fu">simLexis</span>(Tr, inL, <span class="at">N =</span> <span class="dv">500</span>, <span class="at">t.range =</span> <span class="dv">12</span>))</span></code></pre></div>
<pre><code>   user  system elapsed 
  2.653   3.299   2.046 </code></pre>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb805-1"><a href="time-dependent-variables-and-multiple-states.html#cb805-1" tabindex="-1"></a><span class="fu">summary</span>(sM, <span class="at">by =</span> <span class="st">&quot;sex&quot;</span>)</span></code></pre></div>
<pre><code>$M

Transitions:
     To
From  NRA Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA  30  67  403         0       500      470    2773.04       500
  Rem   0  46    0        21        67       21     426.76        67
  Sum  30 113  403        21       567      491    3199.80       500

$F

Transitions:
     To
From  NRA Rem ESRD ESRD(Rem)  Records:  Events: Risk time:  Persons:
  NRA  25 172  303         0       500      475    2396.13       500
  Rem   0 105    0        67       172       67    1175.31       172
  Sum  25 277  303        67       672      542    3571.44       500</code></pre>
<p>Why are there so many ESRD-events in the resulting data set?</p></li>
<li><p>Now count how many persons are present in each state
at each time for the first 10 years after entry (which is at age 50). This
can be done by using <code>nState</code>. Try:</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb807-1"><a href="time-dependent-variables-and-multiple-states.html#cb807-1" tabindex="-1"></a>nStm <span class="ot">&lt;-</span> <span class="fu">nState</span>(<span class="fu">subset</span>(sM, sex <span class="sc">==</span> <span class="st">&quot;M&quot;</span>), <span class="at">time.scale =</span> <span class="st">&quot;age&quot;</span>, </span>
<span id="cb807-2"><a href="time-dependent-variables-and-multiple-states.html#cb807-2" tabindex="-1"></a>               <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>), </span>
<span id="cb807-3"><a href="time-dependent-variables-and-multiple-states.html#cb807-3" tabindex="-1"></a>             <span class="at">from =</span> <span class="dv">50</span>)</span>
<span id="cb807-4"><a href="time-dependent-variables-and-multiple-states.html#cb807-4" tabindex="-1"></a>nStf <span class="ot">&lt;-</span> <span class="fu">nState</span>(<span class="fu">subset</span>(sM, sex <span class="sc">==</span> <span class="st">&quot;F&quot;</span>), <span class="at">time.scale =</span> <span class="st">&quot;age&quot;</span>, </span>
<span id="cb807-5"><a href="time-dependent-variables-and-multiple-states.html#cb807-5" tabindex="-1"></a>               <span class="at">at =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.1</span>), </span>
<span id="cb807-6"><a href="time-dependent-variables-and-multiple-states.html#cb807-6" tabindex="-1"></a>             <span class="at">from =</span> <span class="dv">50</span>)</span>
<span id="cb807-7"><a href="time-dependent-variables-and-multiple-states.html#cb807-7" tabindex="-1"></a><span class="fu">head</span>(nStf, <span class="dv">15</span>)</span></code></pre></div>
<pre><code>      State
when   NRA Rem ESRD ESRD(Rem)
  50   500   0    0         0
  50.1 489   6    5         0
  50.2 483  12    5         0
  50.3 473  16   11         0
  50.4 467  20   13         0
  50.5 466  21   13         0
  50.6 462  25   13         0
  50.7 459  28   13         0
  50.8 458  29   13         0
  50.9 450  34   16         0
  51   444  36   20         0
  51.1 441  37   22         0
  51.2 435  40   25         0
  51.3 429  43   27         1
  51.4 420  48   31         1</code></pre>
<p>What is in the object <code>nStf</code>?</p></li>
<li><p>With the counts of persons in each state at the
designated time points (in <code>nStm</code>), compute the cumulative
fraction over the states, arranged in order given by <code>perm</code>:</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb809-1"><a href="time-dependent-variables-and-multiple-states.html#cb809-1" tabindex="-1"></a>ppm <span class="ot">&lt;-</span> <span class="fu">pState</span>(nStm, <span class="at">perm =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb809-2"><a href="time-dependent-variables-and-multiple-states.html#cb809-2" tabindex="-1"></a>ppf <span class="ot">&lt;-</span> <span class="fu">pState</span>(nStf, <span class="at">perm =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">4</span>))</span>
<span id="cb809-3"><a href="time-dependent-variables-and-multiple-states.html#cb809-3" tabindex="-1"></a><span class="fu">head</span>(ppf)</span></code></pre></div>
<pre><code>      State
when     Rem   NRA ESRD ESRD(Rem)
  50   0.000 1.000    1         1
  50.1 0.012 0.990    1         1
  50.2 0.024 0.990    1         1
  50.3 0.032 0.978    1         1
  50.4 0.040 0.974    1         1
  50.5 0.042 0.974    1         1</code></pre>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb811-1"><a href="time-dependent-variables-and-multiple-states.html#cb811-1" tabindex="-1"></a><span class="fu">tail</span>(ppf)</span></code></pre></div>
<pre><code>      State
when     Rem   NRA  ESRD ESRD(Rem)
  59.5 0.226 0.346 0.902         1
  59.6 0.226 0.344 0.902         1
  59.7 0.224 0.342 0.900         1
  59.8 0.224 0.340 0.900         1
  59.9 0.222 0.334 0.898         1
  60   0.224 0.330 0.896         1</code></pre>
<p>What do the entries in <code>ppf</code> represent?</p></li>
<li><p>Try to plot the cumulative probabilities using the <code>plot</code> method
for <code>pState</code> objects:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb813-1"><a href="time-dependent-variables-and-multiple-states.html#cb813-1" tabindex="-1"></a><span class="fu">plot</span>(ppf)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/plot-pp-1.png" width="672" /></p>
<p>Is this useful?</p></li>
<li><p>Now try to improve the plot so that it is easier to read, and
easier to compare between men and women, for example:</p>
<div class="sourceCode" id="cb814"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb814-1"><a href="time-dependent-variables-and-multiple-states.html#cb814-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))</span>
<span id="cb814-2"><a href="time-dependent-variables-and-multiple-states.html#cb814-2" tabindex="-1"></a><span class="co"># Men</span></span>
<span id="cb814-3"><a href="time-dependent-variables-and-multiple-states.html#cb814-3" tabindex="-1"></a><span class="fu">plot</span>(ppm, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;limegreen&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#991111&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>))</span>
<span id="cb814-4"><a href="time-dependent-variables-and-multiple-states.html#cb814-4" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(ppm)), ppm[, <span class="st">&quot;NRA&quot;</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb814-5"><a href="time-dependent-variables-and-multiple-states.html#cb814-5" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">59.5</span>, <span class="fl">0.95</span>, <span class="st">&quot;Men&quot;</span>, <span class="at">adj =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;white&quot;</span>, <span class="at">font =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb814-6"><a href="time-dependent-variables-and-multiple-states.html#cb814-6" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side =</span> <span class="dv">4</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">/</span> <span class="dv">10</span>)</span>
<span id="cb814-7"><a href="time-dependent-variables-and-multiple-states.html#cb814-7" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side =</span> <span class="dv">4</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">99</span> <span class="sc">/</span> <span class="dv">100</span>, <span class="at">labels =</span> <span class="cn">NA</span>, <span class="at">tck =</span> <span class="sc">-</span><span class="fl">0.01</span>)</span>
<span id="cb814-8"><a href="time-dependent-variables-and-multiple-states.html#cb814-8" tabindex="-1"></a><span class="co"># Women </span></span>
<span id="cb814-9"><a href="time-dependent-variables-and-multiple-states.html#cb814-9" tabindex="-1"></a><span class="fu">plot</span>(ppf, <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;limegreen&quot;</span>, <span class="st">&quot;red&quot;</span>, <span class="st">&quot;#991111&quot;</span>, <span class="st">&quot;forestgreen&quot;</span>),</span>
<span id="cb814-10"><a href="time-dependent-variables-and-multiple-states.html#cb814-10" tabindex="-1"></a>          <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">50</span>)) <span class="co"># inverted x-axis</span></span>
<span id="cb814-11"><a href="time-dependent-variables-and-multiple-states.html#cb814-11" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">as.numeric</span>(<span class="fu">rownames</span>(ppf)), ppf[, <span class="st">&quot;NRA&quot;</span>], <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb814-12"><a href="time-dependent-variables-and-multiple-states.html#cb814-12" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">59.5</span>, <span class="fl">0.95</span>, <span class="st">&quot;Women&quot;</span>, <span class="at">adj =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;white&quot;</span>, <span class="at">font =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb814-13"><a href="time-dependent-variables-and-multiple-states.html#cb814-13" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side =</span> <span class="dv">2</span>, <span class="at">at =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">/</span> <span class="dv">10</span>)</span>
<span id="cb814-14"><a href="time-dependent-variables-and-multiple-states.html#cb814-14" tabindex="-1"></a><span class="fu">axis</span>(<span class="at">side =</span> <span class="dv">2</span>, <span class="at">at =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">99</span> <span class="sc">/</span> <span class="dv">100</span>, <span class="at">labels =</span> <span class="cn">NA</span>, <span class="at">tck =</span> <span class="sc">-</span><span class="fl">0.01</span>)</span></code></pre></div>
<p><img src="renal-s_files/figure-html/new-nState-1.png" width="672" /></p>
<p>What is the 10-year risk of remission for men and women respectively?</p></li>
</ol>

</div>
</div>











            </section>

          </div>
        </div>
      </div>
<a href="causal-inference-2-model-based-estimation-of-causal-estimands.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/SPE-R/SPE/edit/master/pracs-book/renal-s.rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["SPE-R-2024-practicals-with-solutions.pdf", "SPE-R-2024-practicals-with-solutions.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
